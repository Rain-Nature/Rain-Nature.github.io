<!DOCTYPE HTML>
<html lang="zh-&#39;CN&#39;">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="语雀01-MybatisPlus.md, Rain">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>语雀01-MybatisPlus.md | Rain</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.2"></head>



   <style>
    body{
       background-image: url(https://cdn.jsdelivr.net/gh/Rain-Nature/Rain-Nature.github.io@master/medias/bg.jpg);
       background-repeat:no-repeat;
       background-size:cover;
       background-attachment:fixed;
    }
</style>



<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Rain</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Rain</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/17.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">语雀01-MybatisPlus.md</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E8%AF%AD%E9%9B%80/">
                                <span class="chip bg-color">语雀</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2025-05-03
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h3 id="一、MyBatis-Plus简介"><a href="#一、MyBatis-Plus简介" class="headerlink" title="一、MyBatis-Plus简介"></a>一、MyBatis-Plus简介</h3><h4 id="1-、简介"><a href="#1-、简介" class="headerlink" title="1 、简介"></a>1 、简介</h4><p>​    MyBatis-Plus （简称 MP）是一个 MyBatis的增强工具 ，在 MyBatis 的基础上 只做增强不做改变 ，为简化开发、提高效率而生 </p>
<h5 id="MybatisPlus的层级关系（共四层）"><a href="#MybatisPlus的层级关系（共四层）" class="headerlink" title="MybatisPlus的层级关系（共四层）"></a>MybatisPlus的层级关系（共四层）</h5><pre class="line-numbers language-none"><code class="language-none">Controller (控制层)
   ↓
Service (业务接口)
   ↓
ServiceImpl (业务实现)
   ↓
Mapper (数据库操作接口)
   ↓
Entity (实体类)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="愿景"><a href="#愿景" class="headerlink" title="愿景"></a>愿景</h5><p>​    我们的愿景是成为 MyBatis 最好的搭档，就像魂斗罗中的 1P、2P，基友搭配，效率翻倍。</p>
<h4 id="2-、特性"><a href="#2-、特性" class="headerlink" title="2 、特性"></a>2 、特性</h4><ul>
<li><strong>无侵入</strong> ：只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑</li>
<li><strong>损耗小</strong> ：启动即会自动注入基本 CURD，性能基本无损耗，直接面向对象操作</li>
<li><strong>强大的 CRUD 操作</strong> ：内置通用 Mapper、通用 Service，仅仅通过少量配置即可实现单表大部分CRUD 操作，更有强大的条件构造器，满足各类使用需求</li>
<li><strong>支持 Lambda 形式调用</strong> ：通过 Lambda 表达式，方便的编写各类查询条件，无需再担心字段写错</li>
<li><strong>支持主键自动生成</strong> ：支持多达 4 种主键策略（内含分布式唯一 ID 生成器 - Sequence），可自由配置，完美解决主键问题</li>
<li><strong>支持 ActiveRecord 模式</strong> ：支持 ActiveRecord 形式调用，实体类只需继承 Model 类即可进行强大的 CRUD 操作</li>
<li><strong>支持自定义全局通用操作</strong> ：支持全局通用方法注入（ Write once, use anywhere ）</li>
<li><strong>内置代码生成器</strong> ：采用代码或者 Maven 插件可快速生成 Mapper 、 Model 、 Service 、Controller 层代码，支持模板引擎，更有超多自定义配置等您来使用</li>
<li><strong>内置分页插件</strong> ：基于 MyBatis 物理分页，开发者无需关心具体操作，配置好插件之后，写分页等同于普通 List 查询</li>
<li><strong>分页插件支持多种数据库</strong> ：支持 MySQL、MariaDB、Oracle、DB2、H2、HSQL、SQLite、Postgre、SQLServer 等多种数据库</li>
<li><strong>内置性能分析插件</strong> ：可输出 SQL 语句以及其执行时间，建议开发测试时启用该功能，能快速揪出慢查询</li>
<li><strong>内置全局拦截插件</strong> ：提供全表 delete 、 update 操作智能分析阻断，也可自定义拦截规则，预防误操作</li>
</ul>
<h4 id="3-、支持数据库"><a href="#3-、支持数据库" class="headerlink" title="3 、支持数据库"></a>3 、支持数据库</h4><p>​    任何能使用MyBatis进行 CRUD, 并且支持标准 SQL 的数据库，具体支持情况如下MySQL，Oracle，DB2，H2，HSQL，SQLite，PostgreSQL，SQLServer，Phoenix，Gauss ，ClickHouse，Sybase，OceanBase，Firebird，Cubrid，Goldilocks，csiidb达梦数据库，虚谷数据库，人大金仓数据库，南大通用(华库)数据库，南大通用数据库，神通数据库，瀚高数据库</p>
<h4 id="4、框架结构"><a href="#4、框架结构" class="headerlink" title="4、框架结构"></a>4、框架结构</h4><p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEIR476"><img src="https://s21.ax1x.com/2025/04/23/pEIR476.png" alt="MybatisPlus框架结构"></a></p>
<h4 id="5、代码及文档地址"><a href="#5、代码及文档地址" class="headerlink" title="5、代码及文档地址"></a>5、代码及文档地址</h4><h5 id="官方地址-http-mp-baomidou-com"><a href="#官方地址-http-mp-baomidou-com" class="headerlink" title="官方地址: http://mp.baomidou.com"></a>官方地址: <a target="_blank" rel="noopener" href="http://mp.baomidou.com/">http://mp.baomidou.com</a></h5><h5 id="代码发布地址"><a href="#代码发布地址" class="headerlink" title="代码发布地址:"></a>代码发布地址:</h5><h5 id="Github-https-github-com-baomidou-mybatis-plus"><a href="#Github-https-github-com-baomidou-mybatis-plus" class="headerlink" title="Github: https://github.com/baomidou/mybatis-plus"></a>Github: <a target="_blank" rel="noopener" href="https://github.com/baomidou/mybatis-plus">https://github.com/baomidou/mybatis-plus</a></h5><h5 id="Gitee-https-gitee-com-baomidou-mybatis-plus"><a href="#Gitee-https-gitee-com-baomidou-mybatis-plus" class="headerlink" title="Gitee: https://gitee.com/baomidou/mybatis-plus"></a>Gitee: <a target="_blank" rel="noopener" href="https://gitee.com/baomidou/mybatis-plus">https://gitee.com/baomidou/mybatis-plus</a></h5><h5 id="文档发布地址-https-baomidou-com-pages-24112f"><a href="#文档发布地址-https-baomidou-com-pages-24112f" class="headerlink" title="文档发布地址: https://baomidou.com/pages/24112f"></a>文档发布地址: <a target="_blank" rel="noopener" href="https://baomidou.com/pages/24112f">https://baomidou.com/pages/24112f</a></h5><h3 id="二、入门案例"><a href="#二、入门案例" class="headerlink" title="二、入门案例"></a>二、入门案例</h3><h4 id="1-、开发环境"><a href="#1-、开发环境" class="headerlink" title="1 、开发环境"></a>1 、开发环境</h4><p>​    IDE：idea 2019.</p>
<p>​    JDK：JDK8+</p>
<p>​    构建工具：maven 3.5.4</p>
<p>​    MySQL版本：MySQL 5.7</p>
<p>​    Spring Boot：2.6.3</p>
<p>​    MyBatis-Plus：3.5.1</p>
<h4 id="2-、创建数据库及表"><a href="#2-、创建数据库及表" class="headerlink" title="2 、创建数据库及表"></a>2 、创建数据库及表</h4><h5 id="a-gt-创建表"><a href="#a-gt-创建表" class="headerlink" title="a&gt;创建表"></a>a&gt;创建表</h5><pre class="line-numbers language-none"><code class="language-none">CREATE DATABASE &#96;mybatis_plus&#96; &#x2F;*!40100 DEFAULT CHARACTER SET utf8mb4 *&#x2F;;
 use &#96;mybatis_plus&#96;;
 CREATE TABLE &#96;user&#96; (
 &#96;id&#96; bigint(20) NOT NULL COMMENT &#39;主键ID&#39;,
 &#96;name&#96; varchar(30) DEFAULT NULL COMMENT &#39;姓名&#39;,
 &#96;age&#96; int(11) DEFAULT NULL COMMENT &#39;年龄&#39;,
 &#96;email&#96; varchar(50) DEFAULT NULL COMMENT &#39;邮箱&#39;,
 PRIMARY KEY (&#96;id&#96;)
 ) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="b-gt-添加数据"><a href="#b-gt-添加数据" class="headerlink" title="b&gt;添加数据"></a>b&gt;添加数据</h5><pre class="line-numbers language-none"><code class="language-none">INSERT INTO user (id, name, age, email) VALUES
 (1, &#39;Jone&#39;, 18, &#39;test1@baomidou.com&#39;),
 (2, &#39;Jack&#39;, 20, &#39;test2@baomidou.com&#39;),
 (3, &#39;Tom&#39;, 28, &#39;test3@baomidou.com&#39;),
 (4, &#39;Sandy&#39;, 21, &#39;test4@baomidou.com&#39;),
 (5, &#39;Billie&#39;, 24, &#39;test5@baomidou.com&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="3-、创建Spring-Boot工程"><a href="#3-、创建Spring-Boot工程" class="headerlink" title="3 、创建Spring Boot工程"></a>3 、创建Spring Boot工程</h4><h5 id="a-gt-初始化工程"><a href="#a-gt-初始化工程" class="headerlink" title="a&gt;初始化工程"></a>a&gt;初始化工程</h5><p>​    使用 Spring Initializr 快速初始化一个 Spring Boot 工程（不需要其他依赖）</p>
<h5 id="b-gt-引入依赖"><a href="#b-gt-引入依赖" class="headerlink" title="b&gt;引入依赖"></a>b&gt;引入依赖</h5><pre class="line-numbers language-none"><code class="language-none">&lt;dependencies&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;
		&lt;artifactId&gt;spring-boot-starter&lt;&#x2F;artifactId&gt;
	&lt;&#x2F;dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;
		&lt;scope&gt;test&lt;&#x2F;scope&gt;
	&lt;&#x2F;dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;
		&lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;
		&lt;version&gt;3.5.1&lt;&#x2F;version&gt;
	&lt;&#x2F;dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;
		&lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;
		&lt;optional&gt;true&lt;&#x2F;optional&gt;
	&lt;&#x2F;dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;
		&lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;
		&lt;scope&gt;runtime&lt;&#x2F;scope&gt;
	&lt;&#x2F;dependency&gt;
&lt;&#x2F;dependencies&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="c-gt-idea中安装lombok插件"><a href="#c-gt-idea中安装lombok插件" class="headerlink" title="c&gt;idea中安装lombok插件"></a>c&gt;idea中安装lombok插件</h5><p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEIWFjs"><img src="https://s21.ax1x.com/2025/04/23/pEIWFjs.png" alt="lombook安装"></a></p>
<h4 id="4-、编写代码"><a href="#4-、编写代码" class="headerlink" title="4 、编写代码"></a>4 、编写代码</h4><h5 id="a-gt-配置application-yml"><a href="#a-gt-配置application-yml" class="headerlink" title="a&gt;配置application.yml"></a>a&gt;配置application.yml</h5><pre class="line-numbers language-none"><code class="language-none">spring:
 # 配置数据源信息
 datasource:
  # 配置数据源类型
  type: com.zaxxer.hikari.HikariDataSource
  # 配置连接数据库信息
  driver-class-name: com.mysql.cj.jdbc.Driver
  url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis_plus?characterEncoding&#x3D;utf-8&amp;useSSL&#x3D;false
  username: root
  password: 123456<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h5><p>1 、驱动类driver-class-name</p>
<p>spring boot 2.0（内置jdbc5驱动），驱动类使用：</p>
<p>driver-class-name: com.mysql.jdbc.Driver</p>
<p>spring boot 2.1及以上（内置jdbc8驱动），驱动类使用：</p>
<p>driver-class-name: com.mysql.cj.jdbc.Driver</p>
<p>否则运行测试用例的时候会有 WARN 信息</p>
<p>2 、连接地址url</p>
<p>MySQL5.7版本的url：</p>
<p>jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8&amp;useSSL=false</p>
<p>MySQL8.0版本的url：</p>
<p>jdbc:mysql://localhost:3306/mybatis_plus?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false</p>
<p>否则运行测试用例报告如下错误：</p>
<p>java.sql.SQLException: The server time zone value ‘ÖÐ¹ú±ê×¼Ê±¼ä’ is unrecognized or represents more</p>
<h5 id="b-gt-添加实体"><a href="#b-gt-添加实体" class="headerlink" title="b&gt;添加实体"></a>b&gt;添加实体</h5><pre class="line-numbers language-none"><code class="language-none">@Data &#x2F;&#x2F;lombok注解其等价与@Getter、@Setter、@ToString、@EqualsAndHashCode、@RequiredArgsConstructor
public class User &#123;
	private Long id;
	private String name;
	private Integer age;
	private String email;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>​    User类编译之后的结果：</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEIWYE6"><img src="https://s21.ax1x.com/2025/04/23/pEIWYE6.png" alt="User类编译结果"></a></p>
<h5 id="c-gt-添加mapper"><a href="#c-gt-添加mapper" class="headerlink" title="c&gt;添加mapper"></a>c&gt;添加mapper</h5><p>​    BaseMapper是MyBatis-Plus提供的模板mapper，其中包含了基本的CRUD方法，泛型为操作的实体类型</p>
<pre class="line-numbers language-none"><code class="language-none">public interface UserMapper extends BaseMapper&lt;User&gt; &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="d-gt-启动类"><a href="#d-gt-启动类" class="headerlink" title="d&gt;启动类"></a>d&gt;启动类</h5><p>在Spring Boot启动类中添加@MapperScan注解，扫描mapper包，<code>该注解是MybatisPlus提供的，必须添加</code></p>
<p>​    注意：<code>@MapperScan</code> 注解既可以写在 <strong>Spring Boot 启动类</strong> 上，也可以写在 <strong>配置类</strong> 上。两者的本质作用是一样的：用于告诉 MyBatis 去扫描指定包路径下的 Mapper 接口</p>
<pre class="line-numbers language-none"><code class="language-none">@SpringBootApplication
@MapperScan(&quot;com.atguigu.mybatisplus.mapper&quot;)
public class MybatisplusApplication &#123;

	public static void main(String[] args) &#123;
		SpringApplication.run(MybatisplusApplication.class, args);
	&#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="e-gt-测试"><a href="#e-gt-测试" class="headerlink" title="e&gt;测试"></a>e&gt;测试</h5><pre class="line-numbers language-none"><code class="language-none">@SpringBootTest
public class MybatisPlusTest &#123;
	@Autowired
	private UserMapper userMapper;
	
	@Test
	public void testSelectList()&#123;
		&#x2F;&#x2F;selectList()：根据MP内置的条件构造器查询一个list集合，null表示没有条件，即查询所有
		userMapper.selectList(null).forEach(System.out::println);
	&#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h5 id="结果："><a href="#结果：" class="headerlink" title="结果："></a>结果：</h5><p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEIWaCD"><img src="https://s21.ax1x.com/2025/04/23/pEIWaCD.png" alt="结果"></a></p>
<h5 id="注意：对c"><a href="#注意：对c" class="headerlink" title="注意：对c"></a>注意：对c</h5><p>​    IDEA在 userMapper 处报错，因为找不到注入的对象，其是一个接口，因为类是动态创建的，但是程序可以正确的执行。</p>
<p>​    为了避免报错，可以在mapper接口上添加 @Repository 注解</p>
<pre class="line-numbers language-none"><code class="language-none">@Repository
public interface UserMapper extends BaseMapper&lt;User&gt; &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h5 id="f-gt-添加日志"><a href="#f-gt-添加日志" class="headerlink" title="f&gt;添加日志"></a>f&gt;添加日志</h5><p>​    在application.yml中配置日志输出</p>
<pre class="line-numbers language-none"><code class="language-none"># 配置MyBatis日志
mybatis-plus:
 configuration:
  log-impl: org.apache.ibatis.logging.stdout.StdOutImpl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p>​    日志结果</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEIWrDI"><img src="https://s21.ax1x.com/2025/04/23/pEIWrDI.png" alt="日志输出"></a></p>
<h3 id="三、基本CRUD"><a href="#三、基本CRUD" class="headerlink" title="三、基本CRUD"></a>三、基本CRUD</h3><h4 id="1-、BaseMapper"><a href="#1-、BaseMapper" class="headerlink" title="1 、BaseMapper"></a>1 、BaseMapper</h4><p>​    MyBatis-Plus中的基本CRUD在内置的BaseMapper中都已得到了实现，我们可以直接使用，接口如下：</p>
<pre class="line-numbers language-none"><code class="language-none">package com.baomidou.mybatisplus.core.mapper;

public interface BaseMapper&lt;T&gt; extends Mapper&lt;T&gt; &#123;

    &#x2F;**
     * 插入一条记录
     * @param entity 实体对象
    *&#x2F;
    int insert(T entity);

    &#x2F;**
     * 根据 ID 删除
     * @param id 主键ID
    *&#x2F;
    int deleteById(Serializable id);

    &#x2F;**
     * 根据实体(ID)删除
     * @param entity 实体对象
     * @since 3.4.
    *&#x2F;
    int deleteById(T entity);

    &#x2F;**
     * 根据 columnMap 条件，删除记录
     * @param columnMap 表字段 map 对象
    *&#x2F;
    int deleteByMap(@Param(Constants.COLUMN_MAP) Map&lt;String, Object&gt; columnMap);

    &#x2F;**
     * 根据 entity 条件，删除记录
     * @param queryWrapper 实体对象封装操作类（可以为 null,里面的 entity 用于生成 where 语句）
    *&#x2F;
    int delete(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);

    &#x2F;**
     * 删除（根据ID 批量删除）
     * @param idList 主键ID列表(不能为 null 以及 empty)
    *&#x2F;
    int deleteBatchIds(@Param(Constants.COLLECTION) Collection&lt;? extends Serializable&gt; idList);

    &#x2F;**
     * 根据 ID 修改
     * @param entity 实体对象
    *&#x2F;
    int updateById(@Param(Constants.ENTITY) T entity);

    &#x2F;**
     * 根据 whereEntity 条件，更新记录
     * @param entity 实体对象 (set 条件值,可以为 null)
     * @param updateWrapper 实体对象封装操作类（可以为 null,里面的 entity 用于生成 where 语句）
    *&#x2F;
    int update(@Param(Constants.ENTITY) T entity, @Param(Constants.WRAPPER) Wrapper&lt;T&gt; updateWrapper);

    &#x2F;**
     * 根据 ID 查询
     * @param id 主键ID
    *&#x2F;
    T selectById(Serializable id);

    &#x2F;**
     * 查询（根据ID 批量查询）
     * @param idList 主键ID列表(不能为 null 以及 empty)
    *&#x2F;
    List&lt;T&gt; selectBatchIds(@Param(Constants.COLLECTION) Collection&lt;? extends Serializable&gt; idList);

    &#x2F;**
     * 查询（根据 columnMap 条件）
     * @param columnMap 表字段 map 对象
    *&#x2F;
    List&lt;T&gt; selectByMap(@Param(Constants.COLUMN_MAP) Map&lt;String, Object&gt; columnMap);

    &#x2F;**
     * 根据 entity 条件，查询一条记录
     * &lt;p&gt;查询一条记录，例如 qw.last(&quot;limit 1&quot;) 限制取一条记录, 注意：多条数据会报异常&lt;&#x2F;p&gt;
     * @param queryWrapper 实体对象封装操作类（可以为 null）
    *&#x2F;
    default T selectOne(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper) &#123;
        List&lt;T&gt; ts &#x3D; this.selectList(queryWrapper);
        if (CollectionUtils.isNotEmpty(ts)) &#123;
            if (ts.size() !&#x3D; 1) &#123;
                throw ExceptionUtils.mpe(&quot;One record is expected, but the query result is multiple records&quot;);
            &#125;
            return ts.get(0);
        &#125;
        return null;
    &#125;

    &#x2F;**
     * 根据 Wrapper 条件，查询总记录数
     * @param queryWrapper 实体对象封装操作类（可以为 null）
    *&#x2F;
    Long selectCount(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);

    &#x2F;**
     * 根据 entity 条件，查询全部记录
     * @param queryWrapper 实体对象封装操作类（可以为 null）
    *&#x2F;
    List&lt;T&gt; selectList(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);

    &#x2F;**
     * 根据 Wrapper 条件，查询全部记录
     * @param queryWrapper 实体对象封装操作类（可以为 null）
    *&#x2F;
    List&lt;Map&lt;String, Object&gt;&gt; selectMaps(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);

    &#x2F;**
     * 根据 Wrapper 条件，查询全部记录
     * &lt;p&gt;注意： 只返回第一个字段的值&lt;&#x2F;p&gt;
     * @param queryWrapper 实体对象封装操作类（可以为 null）
    *&#x2F;
    List&lt;Object&gt; selectObjs(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);

    &#x2F;**
     * 根据 entity 条件，查询全部记录（并翻页）
     * @param page 分页查询条件（可以为 RowBounds.DEFAULT）
     * @param queryWrapper 实体对象封装操作类（可以为 null）
    *&#x2F;
    &lt;P extends IPage&lt;T&gt;&gt; P selectPage(P page, @Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);

    &#x2F;**
     * 根据 Wrapper 条件，查询全部记录（并翻页）
     * @param page 分页查询条件
     * @param queryWrapper 实体对象封装操作类
    *&#x2F;
    &lt;P extends IPage&lt;Map&lt;String, Object&gt;&gt;&gt; P selectMapsPage(P page, @Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="2-、MybatisPlus插入-演示"><a href="#2-、MybatisPlus插入-演示" class="headerlink" title="2 、MybatisPlus插入-演示"></a>2 、MybatisPlus插入-演示</h4><pre class="line-numbers language-none"><code class="language-none">@Test
public void testInsert()&#123;
	User user &#x3D; new User(null, &quot;张三&quot;, 23 , &quot;zhangsan@atguigu.com&quot;);
	&#x2F;&#x2F;INSERT INTO user ( id, name, age, email ) VALUES ( ?, ?, ?,? )
	int result &#x3D; userMapper.insert(user);
	System.out.println(&quot;受影响行数：&quot;+result);
	&#x2F;&#x2F;1475754982694199298
	System.out.println(&quot;id自动获取：&quot;+user.getId());
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>​    最终执行的结果，所获取的id为 1475754982694199298</p>
<p>​    这是因为MyBatis-Plus在实现插入数据时，会默认基于雪花算法的策略生成id，<strong>所以在创建表时，id需要为bigint类型，创建实体类时id需要为Long类型</strong></p>
<h4 id="3-、MybatisPlus删除-演示"><a href="#3-、MybatisPlus删除-演示" class="headerlink" title="3 、MybatisPlus删除-演示"></a>3 、MybatisPlus删除-演示</h4><h5 id="a-gt-通过id删除记录"><a href="#a-gt-通过id删除记录" class="headerlink" title="a&gt;通过id删除记录"></a>a&gt;通过id删除记录</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void testDeleteById()&#123;
	&#x2F;&#x2F;通过id删除用户信息
	&#x2F;&#x2F;DELETE FROM user WHERE id&#x3D;?
	int result &#x3D; userMapper.deleteById(1475754982694199298L);
	System.out.println(&quot;受影响行数：&quot;+result);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="b-gt-通过map设置的条件删除记录"><a href="#b-gt-通过map设置的条件删除记录" class="headerlink" title="b&gt;通过map设置的条件删除记录"></a>b&gt;通过map设置的条件删除记录</h5><p>​    把map中条件都满足的数据进行删除</p>
<pre class="line-numbers language-none"><code class="language-none">@Test
public void testDeleteByMap()&#123;
	&#x2F;&#x2F;根据map集合中所设置的条件删除记录
	&#x2F;&#x2F;DELETE FROM user WHERE name &#x3D;? AND age &#x3D;?
	Map&lt;String, Object&gt; map &#x3D; new HashMap&lt;&gt;();
	map.put(&quot;age&quot;, 23 );
	map.put(&quot;name&quot;, &quot;张三&quot;);
	int result &#x3D; userMapper.deleteByMap(map);
	System.out.println(&quot;受影响行数：&quot;+result);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="c-gt-通过id批量删除记录"><a href="#c-gt-通过id批量删除记录" class="headerlink" title="c&gt;通过id批量删除记录"></a>c&gt;通过id批量删除记录</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void testDeleteBatchIds()&#123;
	&#x2F;&#x2F;通过多个id批量删除
	&#x2F;&#x2F;执行的sql为：DELETE FROM user WHERE id IN (? ,? ,? )
	List&lt;Long&gt; idList &#x3D; Arrays.asList(1L, 2L, 3L);
	int result &#x3D; userMapper.deleteBatchIds(idList);
	System.out.println(&quot;受影响行数：&quot;+result);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="4-、MybatisPlus修改-演示"><a href="#4-、MybatisPlus修改-演示" class="headerlink" title="4 、MybatisPlus修改-演示"></a>4 、MybatisPlus修改-演示</h4><pre class="line-numbers language-none"><code class="language-none">@Test
public void testUpdateById()&#123;
	User user &#x3D; new User(4L, &quot;admin&quot;, 22 , null); &#x2F;&#x2F;为空的email不会进行修改
	&#x2F;&#x2F;UPDATE user SET name&#x3D;?, age&#x3D;? WHERE id&#x3D;?
	int result &#x3D; userMapper.updateById(user);
	System.out.println(&quot;受影响行数：&quot;+result);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="5-、MybatisPlus查询-演示"><a href="#5-、MybatisPlus查询-演示" class="headerlink" title="5 、MybatisPlus查询-演示"></a>5 、MybatisPlus查询-演示</h4><h5 id="a-gt-根据id查询用户信息"><a href="#a-gt-根据id查询用户信息" class="headerlink" title="a&gt;根据id查询用户信息"></a>a&gt;根据id查询用户信息</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void testSelectById()&#123;
	&#x2F;&#x2F;根据id查询用户信息
	&#x2F;&#x2F;SELECT id,name,age,email FROM user WHERE id&#x3D;?
	User user &#x3D; userMapper.selectById(4L);
	System.out.println(user);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="b-gt-根据多个id查询多个用户信息"><a href="#b-gt-根据多个id查询多个用户信息" class="headerlink" title="b&gt;根据多个id查询多个用户信息"></a>b&gt;根据多个id查询多个用户信息</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void testSelectBatchIds()&#123;
	&#x2F;&#x2F;根据多个id查询多个用户信息
	&#x2F;&#x2F;SELECT id,name,age,email FROM user WHERE id IN (? ,? )
	List&lt;Long&gt; idList &#x3D; Arrays.asList(4L, 5L);
	List&lt;User&gt; list &#x3D; userMapper.selectBatchIds(idList);
	list.forEach(System.out::println);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="c-gt-通过map设置的条件查询用户信息"><a href="#c-gt-通过map设置的条件查询用户信息" class="headerlink" title="c&gt;通过map设置的条件查询用户信息"></a>c&gt;通过map设置的条件查询用户信息</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void testSelectByMap()&#123;
	&#x2F;&#x2F;通过map条件查询用户信息
	&#x2F;&#x2F;SELECT id,name,age,email FROM user WHERE name &#x3D;? AND age &#x3D;?
	Map&lt;String, Object&gt; map &#x3D; new HashMap&lt;&gt;();
	map.put(&quot;age&quot;, 22 );
	map.put(&quot;name&quot;, &quot;admin&quot;);
	List&lt;User&gt; list &#x3D; userMapper.selectByMap(map);
	list.forEach(System.out::println);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="d-gt-查询所有数据"><a href="#d-gt-查询所有数据" class="headerlink" title="d&gt;查询所有数据"></a>d&gt;查询所有数据</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void testSelectList()&#123;
	&#x2F;&#x2F;查询所有用户信息
	&#x2F;&#x2F;SELECT id,name,age,email FROM user
	&#x2F;&#x2F;需要传条件构造器，为null表示查全部
	List&lt;User&gt; list &#x3D; userMapper.selectList(null);
	list.forEach(System.out::println);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>​    通过观察BaseMapper中的方法，大多方法中都有Wrapper类型的形参，此为条件构造器，可针对于SQL语句设置不同的条件，若没有条件，则可以为该形参赋值null，即查询（删除/修改）所有数据</p>
<h4 id="6-、通用Service"><a href="#6-、通用Service" class="headerlink" title="6 、通用Service"></a>6 、通用Service</h4><h5 id="说明"><a href="#说明" class="headerlink" title="说明:"></a>说明:</h5><ul>
<li>通用 Service CRUD 封装IService接口，进一步封装 CRUD 采用 get 查询单行 remove 删除 list 查询集合 page 分页 前缀命名方式区分 Mapper 层避免混淆</li>
<li>泛型 T 为任意实体对象</li>
<li>建议如果存在自定义通用 Service 方法的可能，请创建自己的 IBaseService 继承Mybatis-Plus 提供的基类</li>
<li>官网地址：<a target="_blank" rel="noopener" href="https://baomidou.com/pages/49cc81/#service-crud-%E6%8E%A5%E5%8F%A3">https://baomidou.com/pages/49cc81/#service-crud-%E6%8E%A5%E5%8F%A3</a></li>
</ul>
<h5 id="a-gt-IService"><a href="#a-gt-IService" class="headerlink" title="a&gt;IService"></a>a&gt;IService</h5><p>​    MyBatis-Plus中有一个接口 IService和其实现类 ServiceImpl，封装了常见的业务层逻辑，接口如下</p>
<pre class="line-numbers language-none"><code class="language-none">package com.baomidou.mybatisplus.extension.service;

public interface IService&lt;T&gt; &#123;
    &#x2F;&#x2F; 默认批处理大小
    int DEFAULT_BATCH_SIZE &#x3D; 1000;

    &#x2F;&#x2F; 插入一条数据
    default boolean save(T entity) &#123;
        return SqlHelper.retBool(this.getBaseMapper().insert(entity));
    &#125;

    &#x2F;&#x2F; 批量插入（默认批次大小）
    @Transactional(rollbackFor &#x3D; &#123;Exception.class&#125;)
    default boolean saveBatch(Collection&lt;T&gt; entityList) &#123;
        return this.saveBatch(entityList, 1000);
    &#125;

    &#x2F;&#x2F; 批量插入（自定义批次大小）
    boolean saveBatch(Collection&lt;T&gt; entityList, int batchSize);

    &#x2F;&#x2F; 批量保存或更新（默认批次大小）
    @Transactional(rollbackFor &#x3D; &#123;Exception.class&#125;)
    default boolean saveOrUpdateBatch(Collection&lt;T&gt; entityList) &#123;
        return this.saveOrUpdateBatch(entityList, 1000);
    &#125;

    &#x2F;&#x2F; 批量保存或更新（自定义批次大小）
    boolean saveOrUpdateBatch(Collection&lt;T&gt; entityList, int batchSize);

    &#x2F;&#x2F; 根据主键删除一条记录
    default boolean removeById(Serializable id) &#123;
        return SqlHelper.retBool(this.getBaseMapper().deleteById(id));
    &#125;

    &#x2F;&#x2F; 根据主键删除（带填充功能，暂不支持）
    default boolean removeById(Serializable id, boolean useFill) &#123;
        throw new UnsupportedOperationException(&quot;不支持的方法!&quot;);
    &#125;

    &#x2F;&#x2F; 根据实体主键值删除记录
    default boolean removeById(T entity) &#123;
        return SqlHelper.retBool(this.getBaseMapper().deleteById(entity));
    &#125;

    &#x2F;&#x2F; 根据 Map 条件删除记录
    default boolean removeByMap(Map&lt;String, Object&gt; columnMap) &#123;
        Assert.notEmpty(columnMap, &quot;error: columnMap must not be empty&quot;, new Object[0]);
        return SqlHelper.retBool(this.getBaseMapper().deleteByMap(columnMap));
    &#125;

    &#x2F;&#x2F; 根据 Wrapper 条件构造器删除记录
    default boolean remove(Wrapper&lt;T&gt; queryWrapper) &#123;
        return SqlHelper.retBool(this.getBaseMapper().delete(queryWrapper));
    &#125;

    &#x2F;&#x2F; 根据主键集合批量删除
    default boolean removeByIds(Collection&lt;?&gt; list) &#123;
        return CollectionUtils.isEmpty(list) ? false : SqlHelper.retBool(this.getBaseMapper().deleteBatchIds(list));
    &#125;

    &#x2F;&#x2F; 批量删除（是否使用填充）
    @Transactional(rollbackFor &#x3D; &#123;Exception.class&#125;)
    default boolean removeByIds(Collection&lt;?&gt; list, boolean useFill) &#123;
        if (CollectionUtils.isEmpty(list)) &#123;
            return false;
        &#125; else &#123;
            return useFill ? this.removeBatchByIds(list, true) : SqlHelper.retBool(this.getBaseMapper().deleteBatchIds(list));
        &#125;
    &#125;

    &#x2F;&#x2F; 批量删除（默认批次大小）
    @Transactional(rollbackFor &#x3D; &#123;Exception.class&#125;)
    default boolean removeBatchByIds(Collection&lt;?&gt; list) &#123;
        return this.removeBatchByIds(list, 1000);
    &#125;

    &#x2F;&#x2F; 批量删除（默认批次+使用填充）
    @Transactional(rollbackFor &#x3D; &#123;Exception.class&#125;)
    default boolean removeBatchByIds(Collection&lt;?&gt; list, boolean useFill) &#123;
        return this.removeBatchByIds(list, 1000, useFill);
    &#125;

    &#x2F;&#x2F; 批量删除（自定义批次大小）
    default boolean removeBatchByIds(Collection&lt;?&gt; list, int batchSize) &#123;
        throw new UnsupportedOperationException(&quot;不支持的方法!&quot;);
    &#125;

    &#x2F;&#x2F; 批量删除（自定义批次大小 + 填充）
    default boolean removeBatchByIds(Collection&lt;?&gt; list, int batchSize, boolean useFill) &#123;
        throw new UnsupportedOperationException(&quot;不支持的方法!&quot;);
    &#125;

    &#x2F;&#x2F; 根据主键更新记录
    default boolean updateById(T entity) &#123;
        return SqlHelper.retBool(this.getBaseMapper().updateById(entity));
    &#125;

    &#x2F;&#x2F; 使用 Wrapper 条件更新，entity 传 null
    default boolean update(Wrapper&lt;T&gt; updateWrapper) &#123;
        return this.update((Object)null, updateWrapper);
    &#125;

    &#x2F;&#x2F; 条件更新：Wrapper 指定条件，entity 提供更新值
    default boolean update(T entity, Wrapper&lt;T&gt; updateWrapper) &#123;
        return SqlHelper.retBool(this.getBaseMapper().update(entity, updateWrapper));
    &#125;

    &#x2F;&#x2F; 批量更新（默认批次大小）
    @Transactional(rollbackFor &#x3D; &#123;Exception.class&#125;)
    default boolean updateBatchById(Collection&lt;T&gt; entityList) &#123;
        return this.updateBatchById(entityList, 1000);
    &#125;

    &#x2F;&#x2F; 批量更新（自定义批次大小）
    boolean updateBatchById(Collection&lt;T&gt; entityList, int batchSize);

    &#x2F;&#x2F; 保存或更新单条记录，传入id为更新，不传id为保存
    boolean saveOrUpdate(T entity);

    &#x2F;&#x2F; 根据主键查询记录
    default T getById(Serializable id) &#123;
        return (T)this.getBaseMapper().selectById(id);
    &#125;

    &#x2F;&#x2F; 根据主键集合批量查询
    default List&lt;T&gt; listByIds(Collection&lt;? extends Serializable&gt; idList) &#123;
        return this.getBaseMapper().selectBatchIds(idList);
    &#125;

    &#x2F;&#x2F; 根据字段 map 查询
    default List&lt;T&gt; listByMap(Map&lt;String, Object&gt; columnMap) &#123;
        return this.getBaseMapper().selectByMap(columnMap);
    &#125;

    &#x2F;&#x2F; 查询一条记录（默认允许为空）
    default T getOne(Wrapper&lt;T&gt; queryWrapper) &#123;
        return (T)this.getOne(queryWrapper, true);
    &#125;

    &#x2F;&#x2F; 查询一条记录，是否抛异常由参数控制
    T getOne(Wrapper&lt;T&gt; queryWrapper, boolean throwEx);

    &#x2F;&#x2F; 查询一条记录并返回 Map
    Map&lt;String, Object&gt; getMap(Wrapper&lt;T&gt; queryWrapper);

    &#x2F;&#x2F; 查询一条记录并通过 mapper 转换返回值
    &lt;V&gt; V getObj(Wrapper&lt;T&gt; queryWrapper, Function&lt;? super Object, V&gt; mapper);

    &#x2F;&#x2F; 查询总记录数
    default long count() &#123;
        return this.count(Wrappers.emptyWrapper());
    &#125;

    &#x2F;&#x2F; 条件查询总数
    default long count(Wrapper&lt;T&gt; queryWrapper) &#123;
        return SqlHelper.retCount(this.getBaseMapper().selectCount(queryWrapper));
    &#125;

    &#x2F;&#x2F; 条件查询列表
    default List&lt;T&gt; list(Wrapper&lt;T&gt; queryWrapper) &#123;
        return this.getBaseMapper().selectList(queryWrapper);
    &#125;

    &#x2F;&#x2F; 查询所有记录
    default List&lt;T&gt; list() &#123;
        return this.list(Wrappers.emptyWrapper());
    &#125;

    &#x2F;&#x2F; 分页 + 条件查询
    default &lt;E extends IPage&lt;T&gt;&gt; E page(E page, Wrapper&lt;T&gt; queryWrapper) &#123;
        return (E)this.getBaseMapper().selectPage(page, queryWrapper);
    &#125;

    &#x2F;&#x2F; 简单分页查询
    default &lt;E extends IPage&lt;T&gt;&gt; E page(E page) &#123;
        return (E)this.page(page, Wrappers.emptyWrapper());
    &#125;

    &#x2F;&#x2F; 条件查询并返回 Map 列表
    default List&lt;Map&lt;String, Object&gt;&gt; listMaps(Wrapper&lt;T&gt; queryWrapper) &#123;
        return this.getBaseMapper().selectMaps(queryWrapper);
    &#125;

    &#x2F;&#x2F; 查询所有并返回 Map 列表
    default List&lt;Map&lt;String, Object&gt;&gt; listMaps() &#123;
        return this.listMaps(Wrappers.emptyWrapper());
    &#125;

    &#x2F;&#x2F; 查询所有对象
    default List&lt;Object&gt; listObjs() &#123;
        return this.listObjs(Function.identity());
    &#125;

    &#x2F;&#x2F; 查询所有对象并映射
    default &lt;V&gt; List&lt;V&gt; listObjs(Function&lt;? super Object, V&gt; mapper) &#123;
        return this.&lt;V&gt;listObjs(Wrappers.emptyWrapper(), mapper);
    &#125;

    &#x2F;&#x2F; 条件查询对象列表
    default List&lt;Object&gt; listObjs(Wrapper&lt;T&gt; queryWrapper) &#123;
        return this.&lt;Object&gt;listObjs(queryWrapper, Function.identity());
    &#125;

    &#x2F;&#x2F; 条件查询对象并映射
    default &lt;V&gt; List&lt;V&gt; listObjs(Wrapper&lt;T&gt; queryWrapper, Function&lt;? super Object, V&gt; mapper) &#123;
        return (List)this.getBaseMapper().selectObjs(queryWrapper).stream().filter(Objects::nonNull).map(mapper).collect(Collectors.toList());
    &#125;

    &#x2F;&#x2F; 分页查询并返回 Map 列表
    default &lt;E extends IPage&lt;Map&lt;String, Object&gt;&gt;&gt; E pageMaps(E page, Wrapper&lt;T&gt; queryWrapper) &#123;
        return (E)this.getBaseMapper().selectMapsPage(page, queryWrapper);
    &#125;

    &#x2F;&#x2F; 分页 Map 查询（无条件）
    default &lt;E extends IPage&lt;Map&lt;String, Object&gt;&gt;&gt; E pageMaps(E page) &#123;
        return (E)this.pageMaps(page, Wrappers.emptyWrapper());
    &#125;

    &#x2F;&#x2F; 获取底层 Mapper
    BaseMapper&lt;T&gt; getBaseMapper();

    &#x2F;&#x2F; 获取实体类的 Class 对象
    Class&lt;T&gt; getEntityClass();

    &#x2F;&#x2F; 返回 Query 链式封装器
    default QueryChainWrapper&lt;T&gt; query() &#123;
        return ChainWrappers.queryChain(this.getBaseMapper());
    &#125;

    &#x2F;&#x2F; 返回 LambdaQuery 链式封装器
    default LambdaQueryChainWrapper&lt;T&gt; lambdaQuery() &#123;
        return ChainWrappers.lambdaQueryChain(this.getBaseMapper(), this.getEntityClass());
    &#125;

    &#x2F;&#x2F; 返回 LambdaQuery 链式封装器，基于实体初始化
    default LambdaQueryChainWrapper&lt;T&gt; lambdaQuery(T entity) &#123;
        return ChainWrappers.lambdaQueryChain(this.getBaseMapper(), entity);
    &#125;

    &#x2F;&#x2F; Kotlin 风格查询封装器
    default KtQueryChainWrapper&lt;T&gt; ktQuery() &#123;
        return ChainWrappers.ktQueryChain(this.getBaseMapper(), this.getEntityClass());
    &#125;

    &#x2F;&#x2F; Kotlin 风格更新封装器
    default KtUpdateChainWrapper&lt;T&gt; ktUpdate() &#123;
        return ChainWrappers.ktUpdateChain(this.getBaseMapper(), this.getEntityClass());
    &#125;

    &#x2F;&#x2F; 普通链式更新封装器
    default UpdateChainWrapper&lt;T&gt; update() &#123;
        return ChainWrappers.updateChain(this.getBaseMapper());
    &#125;

    &#x2F;&#x2F; Lambda 链式更新封装器
    default LambdaUpdateChainWrapper&lt;T&gt; lambdaUpdate() &#123;
        return ChainWrappers.lambdaUpdateChain(this.getBaseMapper());
    &#125;

    &#x2F;&#x2F; 先尝试更新，不成功再插入
    default boolean saveOrUpdate(T entity, Wrapper&lt;T&gt; updateWrapper) &#123;
        return this.update(entity, updateWrapper) || this.saveOrUpdate(entity);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="b-gt-创建Service接口和实现类"><a href="#b-gt-创建Service接口和实现类" class="headerlink" title="b&gt;创建Service接口和实现类"></a>b&gt;创建Service接口和实现类</h5><pre class="line-numbers language-none"><code class="language-none">&#x2F;**
 * UserService继承IService模板提供的基础功能
 *&#x2F;
public interface UserService extends IService&lt;User&gt; &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-none"><code class="language-none">&#x2F;**
 * ServiceImpl实现了IService，提供了IService中基础功能的实现
 * 若ServiceImpl无法满足业务需求，则可以使用自定的UserService定义方法，并在实现类中实现
 *&#x2F;
@Service
public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements
UserService &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="c-gt-测试查询记录数"><a href="#c-gt-测试查询记录数" class="headerlink" title="c&gt;测试查询记录数"></a>c&gt;测试查询记录数</h5><pre class="line-numbers language-none"><code class="language-none">@Autowired
private UserService userService;

@Test
public void testGetCount()&#123;
	long count &#x3D; userService.count();
	System.out.println(&quot;总记录数：&quot; + count);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="d-gt-测试批量插入"><a href="#d-gt-测试批量插入" class="headerlink" title="d&gt;测试批量插入"></a>d&gt;测试批量插入</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void testSaveBatch()&#123;
	&#x2F;&#x2F; SQL长度有限制，海量数据插入单条SQL无法实行，
	&#x2F;&#x2F; 因此MP将批量插入放在了通用Service中实现，而不是通用Mapper
	ArrayList&lt;User&gt; users &#x3D; new ArrayList&lt;&gt;();
	for (int i &#x3D; 0 ; i &lt; 5 ; i++) &#123;
		User user &#x3D; new User();
		user.setName(&quot;ybc&quot; + i);
		user.setAge( 20 + i);
		users.add(user);
	&#125;
	&#x2F;&#x2F;SQL:INSERT INTO t_user ( username, age ) VALUES ( ?,? )
	userService.saveBatch(users);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="e-gt-当前只做这两个方法作为样例"><a href="#e-gt-当前只做这两个方法作为样例" class="headerlink" title="e&gt;当前只做这两个方法作为样例"></a>e&gt;当前只做这两个方法作为样例</h5><p>​    <strong>具体的所有方法可以打开类的structure进行查看</strong></p>
<h3 id="四、Mybatis和MybatisPlus的混合开发"><a href="#四、Mybatis和MybatisPlus的混合开发" class="headerlink" title="四、Mybatis和MybatisPlus的混合开发"></a>四、Mybatis和MybatisPlus的混合开发</h3><h4 id="1、开发步骤"><a href="#1、开发步骤" class="headerlink" title="1、开发步骤"></a>1、开发步骤</h4><p>​    1.在application.yml中进行配置（这是默认配置可以省略）：<code>mybatis-plus.plus.mapper-location=classpath*:/mapper/**/*.xml</code></p>
<p>​    2.在resource目录创建mapper，然后再写mapper类的映射文件xxxx.xml(Mybatis)</p>
<p>​    3.找到开发目录mapper包，这个就是mybatisPlus的那个包，对要的那个类定义需要的接口</p>
<p>​    4.在xxxx.xml中配置该接口的sql</p>
<h4 id="2、项目结构图"><a href="#2、项目结构图" class="headerlink" title="2、项目结构图"></a>2、项目结构图</h4><p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEoRjZq"><img src="https://s21.ax1x.com/2025/04/25/pEoRjZq.png" alt="样例"></a></p>
<h3 id="五、MybatisPlus常用注解"><a href="#五、MybatisPlus常用注解" class="headerlink" title="五、MybatisPlus常用注解"></a>五、MybatisPlus常用注解</h3><h4 id="1-、-TableName"><a href="#1-、-TableName" class="headerlink" title="1 、@TableName"></a>1 、@TableName</h4><p>​    经过以上的测试，在使用MyBatis-Plus实现基本的CRUD时，我们并没有指定要操作的表，只是在Mapper接口继承BaseMapper时，设置了泛型User，而操作的表为user表</p>
<p>​    由此得出结论，MyBatis-Plus在确定操作的表时，由BaseMapper的泛型决定，即实体类型决定，且默认操作的表名和实体类型的类名一致</p>
<h5 id="a-gt-问题"><a href="#a-gt-问题" class="headerlink" title="a&gt;问题"></a>a&gt;问题</h5><p>​    若实体类类型的类名和要操作的表的表名不一致，会出现什么问题？</p>
<p>​    我们将表user更名为t_user，测试查询功能</p>
<p>​    程序抛出异常，Table ‘mybatis_plus.user’ doesn’t exist，因为现在的表名为t_user，而默认操作的表名和实体类型的类名一致，即user表</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEomJ5d"><img src="https://s21.ax1x.com/2025/04/24/pEomJ5d.png" alt="异常"></a></p>
<h5 id="b-gt-TableName解决"><a href="#b-gt-TableName解决" class="headerlink" title="b&gt;@TableName解决"></a>b&gt;@TableName解决</h5><p>​    <code>@TableName</code>：写在实体类上，用于为实体类指定对应的数据库表名</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEomN8I"><img src="https://s21.ax1x.com/2025/04/24/pEomN8I.png" alt="实体类"></a></p>
<h5 id="c-gt-通过全局配置解决问题"><a href="#c-gt-通过全局配置解决问题" class="headerlink" title="c&gt;通过全局配置解决问题"></a>c&gt;通过全局配置解决问题</h5><p>​    在开发的过程中，我们经常遇到以上的问题，即实体类所对应的表都有固定的前缀，例如<code>t_</code>或<code>tbl_</code></p>
<p>​    此时，可以使用MyBatis-Plus提供的全局配置，为实体类所对应的表名设置默认的前缀，那么就不需要在每个实体类上通过@TableName标识实体类对应的表</p>
<p>​    在SpringBoot的配置文件：application.yml中进行配置</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;application.yml

mybatis-plus:
 configuration:
 # 配置MyBatis日志
 log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
global-config:
 db-config:
  # 配置MyBatis-Plus操作表的统一前缀
  table-prefix: t_<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="2-、-TableId"><a href="#2-、-TableId" class="headerlink" title="2 、@TableId"></a>2 、@TableId</h4><p>​    MyBatis-Plus在实现CRUD时，会默认将id作为主键列，并在插入数据时，默认基于雪花算法的策略生成id</p>
<h5 id="a-gt-问题-1"><a href="#a-gt-问题-1" class="headerlink" title="a&gt;问题"></a>a&gt;问题</h5><p>​    若实体类和表中表示主键的不是id，而是其他字段，例如uid，MyBatis-Plus会自动识别uid为主键列吗？</p>
<p>​    我们实体类中的属性id改为uid，将表中的字段id也改为uid，测试添加功能</p>
<p>​    程序抛出异常，Field ‘uid’ doesn’t have a default value，说明MyBatis-Plus没有将uid作为主键</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEomhrT"><img src="https://s21.ax1x.com/2025/04/24/pEomhrT.png" alt="异常"></a></p>
<h5 id="b-gt-TableId解决"><a href="#b-gt-TableId解决" class="headerlink" title="b&gt;@TableId解决"></a>b&gt;@TableId解决</h5><p>​    <code>@TableId</code>：写在实体类的属性上，告诉MybatisPlus标识该属性是对应的数据库字段的主键，并可指定主键自动生成策略（如自动增长、UUID等）</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEou54J"><img src="https://s21.ax1x.com/2025/04/24/pEou54J.png" alt="实体类"></a></p>
<h5 id="c-gt-TableId里的value属性"><a href="#c-gt-TableId里的value属性" class="headerlink" title="c&gt;@TableId里的value属性"></a>c&gt;@TableId里的value属性</h5><p>​    value属性对应表中的字段名</p>
<h5 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h5><p>​    若实体类中主键对应的属性为id，而表中表示主键的字段为uid，此时若只在属性id上添加注解@TableId，则抛出异常Unknown column ‘id’ in ‘field list’，即MyBatis-Plus仍然会将id作为表的主键操作，而表中表示主键的是字段uid</p>
<p>​    此时需要通过@TableId注解的value属性，指定表中的主键字段，@TableId(“uid”)或@TableId(value=”uid”)</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEoujED"><img src="https://s21.ax1x.com/2025/04/24/pEoujED.png" alt="异常"></a></p>
<h5 id="d-gt-TableId的type属性"><a href="#d-gt-TableId的type属性" class="headerlink" title="d&gt;@TableId的type属性"></a>d&gt;@TableId的type属性</h5><p>​    type属性用来定义主键生成的策略</p>
<h5 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h5><p>​    1.<code>@TableId(type = IdType.AUTO)</code> 是告诉 MyBatis-Plus 主键使用自增策略，<strong>但是否真的能自增，取决于数据库字段是否设置了 <code>AUTO_INCREMENT</code>，两者需配合使用</strong></p>
<p>​    2.如果在new实体时已经传递了id那么@TableId将会失效，以你new时的id值为参数存入数据库</p>
<h5 id="常用的主键策略："><a href="#常用的主键策略：" class="headerlink" title="常用的主键策略："></a>常用的主键策略：</h5><table>
<thead>
<tr>
<th>值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>IdType.ASSIGN_ID</strong>（默认）</td>
<td>基于雪花算法的策略生成数据id，与数据库id是否设置自增无关。</td>
</tr>
<tr>
<td><strong>IdType.AUTO</strong></td>
<td>使用数据库的自增策略，注意，该类型请确保数据库设置了id自增，否则无效。</td>
</tr>
</tbody></table>
<h5 id="配置全局主键策略："><a href="#配置全局主键策略：" class="headerlink" title="配置全局主键策略："></a>配置全局主键策略：</h5><pre class="line-numbers language-none"><code class="language-none">mybatis-plus:
 configuration:
  # 配置MyBatis日志
  log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
 global-config:
  db-config:
   # 配置MyBatis-Plus操作表的默认前缀
   table-prefix: t_
   # 配置MyBatis-Plus的主键策略
   id-type: auto<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="e-gt-雪花算法"><a href="#e-gt-雪花算法" class="headerlink" title="e&gt;雪花算法"></a>e&gt;雪花算法</h5><h6 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h6><p>​    需要选择合适的方案去应对数据规模的增长，以应对逐渐增长的访问压力和数据量</p>
<p>​    数据库的扩展方式主要包括：业务分库、主从复制，数据库分表</p>
<h6 id="数据库分表"><a href="#数据库分表" class="headerlink" title="数据库分表"></a>数据库分表</h6><p>​    将不同业务数据分散存储到不同的数据库服务器，能够支撑百万甚至千万用户规模的业务，但如果业务继续发展，同一业务的单表数据也会达到单台数据库服务器的处理瓶颈。例如，淘宝的几亿用户数据，如果全部存放在一台数据库服务器的一张表中，肯定是无法满足性能要求的，此时就需要对单表数据进行拆分。</p>
<p>单表数据拆分有两种方式：垂直分表和水平分表。示意图如下：</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEouvUe"><img src="https://s21.ax1x.com/2025/04/24/pEouvUe.png" alt="pEouvUe.png"></a></p>
<h6 id="垂直分表"><a href="#垂直分表" class="headerlink" title="垂直分表"></a>垂直分表</h6><p>​    垂直分表适合将表中某些不常用且占了大量空间的列拆分出去。</p>
<p>​    例如，前面示意图中的 nickname 和 description 字段，假设我们是一个婚恋网站，用户在筛选其他用户的时候，主要是用 age 和 sex 两个字段进行查询，而 nickname 和 description 两个字段主要用于展示，一般不会在业务查询中用到。description 本身又比较长，因此我们可以将这两个字段独立到另外一张表中，这样在查询 age 和 sex 时，就能带来一定的性能提升。</p>
<h6 id="水平分表"><a href="#水平分表" class="headerlink" title="水平分表"></a>水平分表</h6><p>​    水平分表适合表行数特别大的表，有的公司要求单表行数超过 5000 万就必须进行分表，这个数字可以作为参考，但并不是绝对标准，关键还是要看表的访问性能。对于一些比较复杂的表，可能超过 1000万就要分表了；而对于一些简单的表，即使存储数据超过 1 亿行，也可以不分表。但不管怎样，当看到表的数据量达到千万级别时，作为架构师就要警觉起来，因为这很可能是架构的性能瓶颈或者隐患。</p>
<p>​    水平分表相比垂直分表，会引入更多的复杂性，例如要求全局唯一的数据id该如何处理</p>
<h6 id="主键自增"><a href="#主键自增" class="headerlink" title="主键自增"></a>主键自增</h6><p>​    ①以最常见的用户 ID 为例，可以按照 1000000 的范围大小进行分段，1 ~ 999999 放到表 1 中，1000000 ~ 1999999 放到表 2 中，以此类推。</p>
<p>​    ②复杂点：分段大小的选取。分段太小会导致切分后子表数量过多，增加维护复杂度；分段太大可能会导致单表依然存在性能问题，一般建议分段大小在 100 万至 2000 万之间，具体需要根据业务选取合适的分段大小。</p>
<p>​    ③优点：可以随着数据的增加平滑地扩充新的表。例如，现在的用户是 100 万，如果增加到 1000 万，只需要增加新的表就可以了，原有的数据不需要动。</p>
<p>​    ④缺点：分布不均匀。假如按照 1000 万来进行分表，有可能某个分段实际存储的数据量只有 1 条，而另外一个分段实际存储的数据量有 1000 万条。</p>
<h6 id="取模"><a href="#取模" class="headerlink" title="取模"></a>取模</h6><p>​    ①同样以用户 ID 为例，假如我们一开始就规划了 10 个数据库表，可以简单地用 user_id % 10 的值来表示数据所属的数据库表编号，ID 为 985 的用户放到编号为 5 的子表中，ID 为 10086 的用户放到编号为 6 的子表中。</p>
<p>​    ②复杂点：初始表数量的确定。表数量太多维护比较麻烦，表数量太少又可能导致单表性能存在问题。</p>
<p>​    ③优点：表分布比较均匀。</p>
<p>​    ④缺点：扩充新的表很麻烦，所有数据都要重分布。</p>
<h6 id="雪花算法"><a href="#雪花算法" class="headerlink" title="雪花算法"></a>雪花算法</h6><p>​    雪花算法是由Twitter公布的分布式主键生成算法，它能够保证不同表的主键的不重复性，以及相同表的主键的有序性。</p>
<p>①核心思想：</p>
<p>​    长度共64bit（一个long型）。</p>
<p>​    首先是一个符号位，1bit标识，由于long基本类型在Java中是带符号的，最高位是符号位，正数是 0 ，负数是 1 ，所以id一般是正数，最高位是 0 。</p>
<p>​    41bit时间截(毫秒级)，存储的是时间截的差值（当前时间截 - 开始时间截)，结果约等于69.73年。</p>
<p>​    10bit作为机器的ID（ 5 个bit是数据中心， 5 个bit的机器ID，可以部署在 1024 个节点）。</p>
<p>​    12bit作为毫秒内的流水号（意味着每个节点在每毫秒可以产生 4096 个 ID）。</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEoKSCd"><img src="https://s21.ax1x.com/2025/04/24/pEoKSCd.png" alt="pEoKSCd.png"></a></p>
<p>②优点：整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞，并且效率较高。</p>
<h4 id="3-、-TableField"><a href="#3-、-TableField" class="headerlink" title="3 、@TableField"></a>3 、@TableField</h4><p>​    @TableField：写在类的字段上，用于设置除主键以外字段其对应数据库表字段名（设置时要与数据库中字段一模一样，不要被情况1误导）</p>
<p>​    经过以上的测试，我们可以发现，MyBatis-Plus在执行SQL语句时，要保证实体类中的属性名和表中的字段名一致</p>
<p>​    如果实体类中的属性名和字段名不一致的情况，会出现什么问题呢？</p>
<h5 id="a-gt-情况-1"><a href="#a-gt-情况-1" class="headerlink" title="a&gt;情况 1"></a>a&gt;情况 1</h5><p>​    若实体类中的属性使用的是驼峰命名风格，而表中的字段使用的是下划线命名风格</p>
<p>​    例如实体类属性userName，表中字段user_name</p>
<p>​    此时MyBatis-Plus会自动将下划线命名风格转化为驼峰命名风格</p>
<p>​    相当于在MyBatis中配置</p>
<h5 id="b-gt-情况-2"><a href="#b-gt-情况-2" class="headerlink" title="b&gt;情况 2"></a>b&gt;情况 2</h5><p>​    若实体类中的属性和表中的字段不满足情况 1</p>
<p>​    例如实体类属性name，表中字段username</p>
<p>​    此时需要在实体类属性上使用<code>@TableField(&quot;username&quot;)</code>设置属性所对应的字段名</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEoKCvt"><img src="https://s21.ax1x.com/2025/04/24/pEoKCvt.png" alt="实体类"></a></p>
<h4 id="4-、-TableLogic"><a href="#4-、-TableLogic" class="headerlink" title="4 、@TableLogic"></a>4 、@TableLogic</h4><h5 id="a-gt-逻辑删除"><a href="#a-gt-逻辑删除" class="headerlink" title="a&gt;逻辑删除"></a>a&gt;逻辑删除</h5><ul>
<li>物理删除：真实删除，将对应数据从数据库中删除，之后查询不到此条被删除的数据</li>
<li>逻辑删除：假删除，将对应数据中代表是否被删除字段的状态修改为“被删除状态”，之后在数据库中仍旧能看到此条数据记录</li>
<li>使用场景：可以进行数据恢复</li>
</ul>
<h5 id="b-gt-实现逻辑删除"><a href="#b-gt-实现逻辑删除" class="headerlink" title="b&gt;实现逻辑删除"></a>b&gt;实现逻辑删除</h5><p>step1： 数据库中创建逻辑删除状态列，需要给<code>设置默认值为 0</code>，不然插入数据后该字段为null则无法查询出该数据</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEoKEVS"><img src="https://s21.ax1x.com/2025/04/24/pEoKEVS.png" alt="步骤1"></a></p>
<p>step2： 实体类中添加逻辑删除属性</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEoKZ5Q"><img src="https://s21.ax1x.com/2025/04/24/pEoKZ5Q.png" alt="实体类"></a></p>
<p>step3： 测试</p>
<p>​    在Service层测试删除功能，但真正执行的是修改</p>
<p>​    UPDATE t_user SET is_deleted=1 WHERE id=? AND is_deleted=0</p>
<p>​    在Service层测试查询功能，被逻辑删除的数据默认不会被查询</p>
<p>​    SELECT id,username AS name,age,email,is_deleted FROM t_user WHERE is_deleted=0</p>
<h5 id="注意事项1：关于逻辑删除是否需要配置（被逻辑删除的字段不会被查询）"><a href="#注意事项1：关于逻辑删除是否需要配置（被逻辑删除的字段不会被查询）" class="headerlink" title="注意事项1：关于逻辑删除是否需要配置（被逻辑删除的字段不会被查询）"></a>注意事项1：关于逻辑删除是否需要配置（被逻辑删除的字段不会被查询）</h5><p>MybatisPlus 3.3.x 及以下版本</p>
<ul>
<li>默认支持逻辑删除，不需要在 <code>application.yml</code> 配置</li>
<li>固定：未删除为0，已删除为1，使用 <code>@TableLogic</code> 注解生效</li>
<li>不支持自定义</li>
</ul>
<p>MybatisPlus 3.4.x 及以上版本</p>
<ul>
<li><p>官方推荐在 <code>application.yml</code> 中显式配置逻辑删除的取值（非强制）</p>
</li>
<li><p>只要你字段值是 0/1且字段上加了 <code>@TableLogic</code>不配置yml也能用，但要自定义删除标识的值，就必须配置，否则无效</p>
</li>
<li><p>application.yml配置结构</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;application.yml

mybatis-plus:
  global-config:
    db-config:
      logic-delete-field: 要识别的字段名(Java) # 全局逻辑删除的实体字段名(配置后可以不配置@TableLogic注解)，这句非必须
      logic-delete-value: 1 # 逻辑已删除值(默认为 1)
      logic-not-delete-value: 0 # 逻辑未删除值(默认为 0)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



</li>
</ul>
<h5 id="注意事项2"><a href="#注意事项2" class="headerlink" title="注意事项2"></a>注意事项2</h5><p>​    逻辑删除功能只对Mybatis-Plus自动注入的sql（mybatisPlus提供的API）起效，也就是说，对于手动在<code>Mapper.xml</code>文件配置的sql不会生效，需要单独考虑</p>
<h3 id="六、条件构造器和常用接口"><a href="#六、条件构造器和常用接口" class="headerlink" title="六、条件构造器和常用接口"></a>六、条件构造器和常用接口</h3><h4 id="1-、wapper介绍"><a href="#1-、wapper介绍" class="headerlink" title="1 、wapper介绍"></a>1 、wapper介绍</h4><p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEoKn8s"><img src="https://s21.ax1x.com/2025/04/24/pEoKn8s.png" alt="wappper"></a></p>
<ul>
<li>Wrapper ： 条件构造抽象类，最顶端父类<ul>
<li>AbstractWrapper ： 用于查询条件封装，生成 sql 的 where 条件<ul>
<li>QueryWrapper ： 查询条件封装</li>
<li>UpdateWrapper ： Update 条件封装</li>
<li>AbstractLambdaWrapper ： 使用Lambda 语法<ul>
<li>LambdaQueryWrapper ：用于Lambda语法使用的查询Wrapper</li>
<li>LambdaUpdateWrapper ： Lambda 更新封装Wrapper</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h5><table>
<thead>
<tr>
<th>操作</th>
<th>方法</th>
<th>是否用 Wrapper</th>
<th>使用的 Wrapper 类型</th>
<th>常用写法示例</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>新增</strong></td>
<td><code>insert()</code></td>
<td>❌ 不使用</td>
<td>无</td>
<td><code>userMapper.insert(user)</code></td>
<td>通过实体类插入数据</td>
</tr>
<tr>
<td><strong>查询</strong></td>
<td><code>selectList() selectOne() selectCount()</code> 等</td>
<td>✅ 是</td>
<td><code>QueryWrapper</code> / <code>LambdaQueryWrapper</code></td>
<td><code>queryWrapper.eq(&quot;age&quot;, 20)</code></td>
<td>用来构造 <code>WHERE</code> 条件</td>
</tr>
<tr>
<td><strong>更新</strong></td>
<td><code>update(entity, wrapper)</code></td>
<td>✅ 是</td>
<td>✅推荐用：<code>UpdateWrapper</code> / <code>LambdaUpdateWrapper</code>⚠也可用：<code>QueryWrapper</code></td>
<td><code>updateWrapper.eq(&quot;id&quot;, 1).set(&quot;name&quot;, &quot;张三&quot;) userMapper.update(null, updateWrapper)</code></td>
<td>如果用实体做更新值，要用 <code>QueryWrapper</code>；如果用 <code>.set()</code> 更新字段，建议用 <code>UpdateWrapper</code></td>
</tr>
<tr>
<td><strong>删除</strong></td>
<td><code>delete(wrapper)</code></td>
<td>✅ 是</td>
<td><code>QueryWrapper</code> / <code>LambdaQueryWrapper</code></td>
<td><code>queryWrapper.eq(&quot;status&quot;, &quot;inactive&quot;)</code></td>
<td>删除操作只需要条件，用查询型 Wrapper 即可</td>
</tr>
</tbody></table>
<h4 id="2-、QueryWrapper"><a href="#2-、QueryWrapper" class="headerlink" title="2 、QueryWrapper"></a>2 、QueryWrapper</h4><p>​    <code>queryWrapper.xxx()</code> 系列方法不返回“值”，因为它们通过链式调用不断累加 SQL 条件，返回的是构建器自身（this），而非最终结果。另外<code>Wrapper</code> 的链式调用<strong>不是必须连续一条链写到底</strong>，完全可以分开写，只要作用在同一个 <code>Wrapper</code> 对象上即可</p>
<h5 id="a-gt-例-1-：组装查询条件"><a href="#a-gt-例-1-：组装查询条件" class="headerlink" title="a&gt;例 1 ：组装查询条件"></a>a&gt;例 1 ：组装查询条件</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void test01()&#123;
	&#x2F;&#x2F;查询用户名包含a，年龄在 20 到 30 之间，并且邮箱不为null的用户信息
	&#x2F;&#x2F;SELECT id,username AS name,age,email,is_deleted FROM t_user WHERE is_deleted&#x3D;0 AND (username LIKE? AND age BETWEEN? AND? AND email IS NOT NULL)
	QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();
	queryWrapper.like(&quot;username&quot;, &quot;a&quot;)
		.between(&quot;age&quot;, 20 , 30 )
		.isNotNull(&quot;email&quot;);
	List&lt;User&gt; list &#x3D; userMapper.selectList(queryWrapper);
	list.forEach(System.out::println);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="b-gt-例-2-：组装排序条件"><a href="#b-gt-例-2-：组装排序条件" class="headerlink" title="b&gt;例 2 ：组装排序条件"></a>b&gt;例 2 ：组装排序条件</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void test02()&#123;
	&#x2F;&#x2F;按年龄降序查询用户，如果年龄相同则按id升序排列
	&#x2F;&#x2F;SELECT id,username AS name,age,email,is_deleted FROM t_user WHERE is_deleted&#x3D;0 ORDER BY age DESC,id ASC
	QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();
	queryWrapper
		.orderByDesc(&quot;age&quot;)
		.orderByAsc(&quot;id&quot;);
	List&lt;User&gt; users &#x3D; userMapper.selectList(queryWrapper);
	users.forEach(System.out::println);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="c-gt-例-3-：组装删除条件"><a href="#c-gt-例-3-：组装删除条件" class="headerlink" title="c&gt;例 3 ：组装删除条件"></a>c&gt;例 3 ：组装删除条件</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void test03()&#123;
	&#x2F;&#x2F;删除email为空的用户
	&#x2F;&#x2F;DELETE FROM t_user WHERE (email IS NULL)
	QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();
	queryWrapper.isNull(&quot;email&quot;);
	&#x2F;&#x2F;条件构造器也可以构建删除语句的条件
	int result &#x3D; userMapper.delete(queryWrapper);
	System.out.println(&quot;受影响的行数：&quot; + result);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="d-gt-例-4-：使用QueryWrapper实现修改功能"><a href="#d-gt-例-4-：使用QueryWrapper实现修改功能" class="headerlink" title="d&gt;例 4 ：使用QueryWrapper实现修改功能"></a>d&gt;例 4 ：使用QueryWrapper实现修改功能</h5><p>​    需要传递两个参数，1.要修改的实体的内容，2. 满足什么条件就进行修改</p>
<pre class="line-numbers language-none"><code class="language-none">@Test
public void test04() &#123;
	QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();
	&#x2F;&#x2F;将（年龄大于 20 并且用户名中包含有a）或邮箱为null的用户信息修改
	&#x2F;&#x2F;UPDATE t_user SET age&#x3D;?, email&#x3D;? WHERE (username LIKE? AND age &gt;? OR email IS NULL)
	queryWrapper
		.like(&quot;username&quot;, &quot;a&quot;)
		.gt(&quot;age&quot;, 20 )
		.or()
		.isNull(&quot;email&quot;);
	&#x2F;&#x2F;在实体类中设置要修改的属性值
	User user &#x3D; new User();
	user.setAge( 18 );
	user.setEmail(&quot;user@atguigu.com&quot;);
	int result &#x3D; userMapper.update(user, queryWrapper);
	System.out.println(&quot;受影响的行数：&quot; + result);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h5 id="条件优先级（指执行顺序）更改后的实现"><a href="#条件优先级（指执行顺序）更改后的实现" class="headerlink" title="条件优先级（指执行顺序）更改后的实现"></a>条件优先级（指执行顺序）更改后的实现</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void test04() &#123;
	QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();
	&#x2F;&#x2F;将用户名中包含有a并且（年龄大于 20 或邮箱为null）的用户信息修改
	&#x2F;&#x2F;UPDATE t_user SET age&#x3D;?, email&#x3D;? WHERE (username LIKE? AND (age &gt;? OR email IS NULL))
	&#x2F;&#x2F;lambda表达式内的逻辑优先运算
	queryWrapper
		.like(&quot;username&quot;, &quot;a&quot;)
		&#x2F;&#x2F;i表示条件构造器
		.and(i -&gt; i.gt(&quot;age&quot;, 20 ).or().isNull(&quot;email&quot;));
	User user &#x3D; new User();
	user.setAge( 18 );
	user.setEmail(&quot;user@atguigu.com&quot;);
	int result &#x3D; userMapper.update(user, queryWrapper);
	System.out.println(&quot;受影响的行数：&quot; + result);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="e-gt-例-5-：组装select子句：只显示表头的几个需要的字段"><a href="#e-gt-例-5-：组装select子句：只显示表头的几个需要的字段" class="headerlink" title="e&gt;例 5 ：组装select子句：只显示表头的几个需要的字段"></a>e&gt;例 5 ：组装select子句：只显示表头的几个需要的字段</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void test05() &#123;
	&#x2F;&#x2F;查询用户信息的username和age字段
	&#x2F;&#x2F;SELECT username,age FROM t_user
	QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();
	queryWrapper.select(&quot;username&quot;, &quot;age&quot;);
	&#x2F;&#x2F;selectMaps()返回Map集合列表，通常配合select()使用，避免User对象中没有被查询到的列值为null
	List&lt;Map&lt;String, Object&gt;&gt; maps &#x3D; userMapper.selectMaps(queryWrapper);
	maps.forEach(System.out::println);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="f-gt-例-6-：实现子查询"><a href="#f-gt-例-6-：实现子查询" class="headerlink" title="f&gt;例 6 ：实现子查询"></a>f&gt;例 6 ：实现子查询</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void test06() &#123;
	&#x2F;&#x2F;查询id小于等于 3 的用户信息
	&#x2F;&#x2F;SELECT id,username AS name,age,email,is_deleted FROM t_user WHERE (id IN (select id from t_user where id &lt;&#x3D; 3))
	QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();
	queryWrapper.inSql(&quot;id&quot;, &quot;select id from t_user where id &lt;&#x3D; 3&quot;);
	List&lt;User&gt; list &#x3D; userMapper.selectList(queryWrapper);
	list.forEach(System.out::println);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="3-、UpdateWrapper"><a href="#3-、UpdateWrapper" class="headerlink" title="3 、UpdateWrapper"></a>3 、UpdateWrapper</h4><pre class="line-numbers language-none"><code class="language-none">@Test
public void test07() &#123;
	&#x2F;&#x2F;将（年龄大于 20 或邮箱为null）并且用户名中包含有a的用户信息修改
	&#x2F;&#x2F;组装set子句以及修改条件
	UpdateWrapper&lt;User&gt; updateWrapper &#x3D; new UpdateWrapper&lt;&gt;();
	&#x2F;&#x2F;lambda表达式内的逻辑优先运算
	updateWrapper
		.set(&quot;age&quot;, 18 )
		.set(&quot;email&quot;, &quot;user@atguigu.com&quot;)
		.like(&quot;username&quot;, &quot;a&quot;)
		.and(i -&gt; i.gt(&quot;age&quot;, 20 ).or().isNull(&quot;email&quot;));
	&#x2F;&#x2F;这里必须要创建User对象，否则无法应用自动填充。如果没有自动填充，可以设置为null
	&#x2F;&#x2F;UPDATE t_user SET username&#x3D;?, age&#x3D;?,email&#x3D;? WHERE (username LIKE? AND
(age &gt;? OR email IS NULL))
	&#x2F;&#x2F;User user &#x3D; new User();
	&#x2F;&#x2F;user.setName(&quot;张三&quot;);
	&#x2F;&#x2F;int result &#x3D; userMapper.update(user, updateWrapper);
	&#x2F;&#x2F;UPDATE t_user SET age&#x3D;?,email&#x3D;? WHERE (username LIKE? AND (age &gt;? OR
email IS NULL))
	&#x2F;&#x2F;这里不需要实体类对象，所以是null
	int result &#x3D; userMapper.update(null, updateWrapper);
	System.out.println(result);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="4-、模拟开发中条件的组装情况"><a href="#4-、模拟开发中条件的组装情况" class="headerlink" title="4 、模拟开发中条件的组装情况"></a>4 、模拟开发中条件的组装情况</h4><p>​    在真正开发的过程中，组装条件是常见的功能，而这些条件数据来源于用户输入，是可选的，因此我们在组装这些条件时，必须先判断用户是否选择了这些条件，若选择则需要组装该条件，若没有选择则一定不能组装，以免影响SQL执行的结果</p>
<h5 id="思路一：使用if判断"><a href="#思路一：使用if判断" class="headerlink" title="思路一：使用if判断"></a>思路一：使用if判断</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void test08() &#123;
	&#x2F;&#x2F;定义查询条件，有可能为null（用户未输入或未选择）
	String username &#x3D; null;
	Integer ageBegin &#x3D; 10 ;
	Integer ageEnd &#x3D; 24 ;
	QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();
	&#x2F;&#x2F;StringUtils.isNotBlank()判断某字符串是否不为空且长度不为 0 且不由空白符(whitespace)构成
	if(StringUtils.isNotBlank(username))&#123;
		queryWrapper.like(&quot;username&quot;,&quot;a&quot;);
	&#125;
	if(ageBegin !&#x3D; null)&#123;
		queryWrapper.ge(&quot;age&quot;, ageBegin);
	&#125;
	if(ageEnd !&#x3D; null)&#123;
		queryWrapper.le(&quot;age&quot;, ageEnd);
	&#125;
	&#x2F;&#x2F;SELECT id,username AS name,age,email,is_deleted FROM t_user WHERE (age &gt;&#x3D; ? AND age &lt;&#x3D; ?)
	List&lt;User&gt; users &#x3D; userMapper.selectList(queryWrapper);
	users.forEach(System.out::println);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="思路二：使用condition，其是方法里的参数"><a href="#思路二：使用condition，其是方法里的参数" class="headerlink" title="思路二：使用condition，其是方法里的参数"></a>思路二：使用condition，其是方法里的参数</h5><p>​    上面的实现方案没有问题，但是代码比较复杂，我们可以使用带condition参数的重载方法构建查询条件，简化代码的编写</p>
<pre class="line-numbers language-none"><code class="language-none">@Test
public void test08UseCondition() &#123;
	&#x2F;&#x2F;定义查询条件，有可能为null（用户未输入或未选择）
	String username &#x3D; null;
	Integer ageBegin &#x3D; 10 ;
	Integer ageEnd &#x3D; 24 ;
	QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();
	&#x2F;&#x2F;StringUtils.isNotBlank()判断某字符串是否不为空且长度不为 0 且不由空白符(whitespace)
构成
	queryWrapper
		.like(StringUtils.isNotBlank(username), &quot;username&quot;, &quot;a&quot;)
		.ge(ageBegin !&#x3D; null, &quot;age&quot;, ageBegin)
		.le(ageEnd !&#x3D; null, &quot;age&quot;, ageEnd);
	&#x2F;&#x2F;SELECT id,username AS name,age,email,is_deleted FROM t_user WHERE (age &gt;&#x3D; ? AND age &lt;&#x3D; ?)
	List&lt;User&gt; users &#x3D; userMapper.selectList(queryWrapper);
	users.forEach(System.out::println);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="5-、LambdaQueryWrapper"><a href="#5-、LambdaQueryWrapper" class="headerlink" title="5 、LambdaQueryWrapper"></a>5 、LambdaQueryWrapper</h4><p>​    使用其可以防止写数据库字名时写错的可能，用的是实体类中某属性，而不是写数据库列名</p>
<pre class="line-numbers language-none"><code class="language-none">@Test
public void test09() &#123;
	&#x2F;&#x2F;定义查询条件，有可能为null（用户未输入）
	String username &#x3D; &quot;a&quot;;
	Integer ageBegin &#x3D; 10 ;
	Integer ageEnd &#x3D; 24 ;
	LambdaQueryWrapper&lt;User&gt; queryWrapper &#x3D; new LambdaQueryWrapper&lt;&gt;();
	&#x2F;&#x2F;避免使用字符串表示字段，防止运行时错误
	queryWrapper
		.like(StringUtils.isNotBlank(username), User::getName, username)
		.ge(ageBegin !&#x3D; null, User::getAge, ageBegin)
		.le(ageEnd !&#x3D; null, User::getAge, ageEnd);
	List&lt;User&gt; users &#x3D; userMapper.selectList(queryWrapper);
	users.forEach(System.out::println);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="6-、LambdaUpdateWrapper"><a href="#6-、LambdaUpdateWrapper" class="headerlink" title="6 、LambdaUpdateWrapper"></a>6 、LambdaUpdateWrapper</h4><p>​    使用其可以防止写数据库列名时写错的可能</p>
<pre class="line-numbers language-none"><code class="language-none">@Test
public void test10() &#123;
	&#x2F;&#x2F;组装set子句
	LambdaUpdateWrapper&lt;User&gt; updateWrapper &#x3D; new LambdaUpdateWrapper&lt;&gt;();
	updateWrapper
		.set(User::getAge, 18 )
		.set(User::getEmail, &quot;user@atguigu.com&quot;)
		.like(User::getName, &quot;a&quot;)
		.and(i -&gt; i.lt(User::getAge, 24 ).or().isNull(User::getEmail));&#x2F;&#x2F;lambda表达式内的逻辑优先运算
	User user &#x3D; new User();
	int result &#x3D; userMapper.update(user, updateWrapper);
	System.out.println(&quot;受影响的行数：&quot; + result);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="7、区别"><a href="#7、区别" class="headerlink" title="7、区别"></a>7、区别</h4><p>​    只写Query，update同理</p>
<table>
<thead>
<tr>
<th>Wrapper 类型</th>
<th>字段写法</th>
<th>容错性</th>
</tr>
</thead>
<tbody><tr>
<td><code>QueryWrapper</code></td>
<td>字段名用 <strong>字符串</strong> 表示</td>
<td><strong>不安全，易写错</strong></td>
</tr>
<tr>
<td><code>LambdaQueryWrapper</code></td>
<td>字段名用 <strong>lambda 表达式</strong></td>
<td><strong>安全，支持重构检查</strong></td>
</tr>
</tbody></table>
<p>​    </p>
<h5 id="区别的样例"><a href="#区别的样例" class="headerlink" title="区别的样例"></a>区别的样例</h5><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; QueryWrapper（字段名写错编译不报错，运行才出问题）
queryWrapper.like(&quot;username&quot;, &quot;Tom&quot;);

&#x2F;&#x2F; LambdaQueryWrapper（字段名通过 getter 方法引用，类型安全）
lambdaQueryWrapper.like(User::getUsername, &quot;Tom&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="七、插件-以实现分页查询"><a href="#七、插件-以实现分页查询" class="headerlink" title="七、插件-以实现分页查询"></a>七、插件-以实现分页查询</h3><h4 id="1-、分页插件"><a href="#1-、分页插件" class="headerlink" title="1 、分页插件"></a>1 、分页插件</h4><p>​    MyBatis Plus自带分页插件，只要简单的配置即可实现分页功能</p>
<h5 id="核心步骤"><a href="#核心步骤" class="headerlink" title="核心步骤"></a>核心步骤</h5><p>​    1.定义page，page&lt;要分页的类名&gt; page = new page()</p>
<p>​    2.使用service层或mapper层的方法执行page，当多参数时使用@Param注解</p>
<p>​    注意：page可以在service层定义，然后mapper层调用</p>
<h5 id="分页插件的使用的区别"><a href="#分页插件的使用的区别" class="headerlink" title="分页插件的使用的区别"></a>分页插件的使用的区别</h5><table>
<thead>
<tr>
<th>使用位置</th>
<th>使用方式</th>
<th>场景适用</th>
<th>是否需要自定义 SQL</th>
</tr>
</thead>
<tbody><tr>
<td>Mapper 层</td>
<td><code>selectPage(page, wrapper)</code> 或 自定义 SQL</td>
<td>复杂查询、自定义分页</td>
<td>需要时写 XML</td>
</tr>
<tr>
<td>Service 层</td>
<td><code>page(page, wrapper)</code></td>
<td>简单分页、业务调用更高层封装</td>
<td>否（适用于标准分页）</td>
</tr>
</tbody></table>
<p>​    注意：Mybatis Plus的<code>BaseMapper</code>和<code>ServiceImpl</code>均提供了常用的分页查询的方法，例如：</p>
<ul>
<li><p><code>BaseMapper</code>的分页查询：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">selectPage</span><span class="token punctuation">(</span><span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> page<span class="token punctuation">,</span><span class="token class-name">Wrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>ServiceImpl</code>的分页查询：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 无条件分页查询</span>
<span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">page</span><span class="token punctuation">(</span><span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 条件分页查询</span>
<span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">page</span><span class="token punctuation">(</span><span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> page<span class="token punctuation">,</span> <span class="token class-name">Wrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



</li>
</ul>
<h5 id="a-gt-添加配置类"><a href="#a-gt-添加配置类" class="headerlink" title="a&gt;添加配置类"></a>a&gt;添加配置类</h5><pre class="line-numbers language-none"><code class="language-none">@Configuration
@MapperScan(&quot;com.atguigu.mybatisplus.mapper&quot;)  &#x2F;&#x2F;可以将主类中的注解移到此处，这个是扫描MybatisPlus注解的注解
public class MybatisPlusConfig &#123;

	@Bean
	public MybatisPlusInterceptor mybatisPlusInterceptor() &#123;
		MybatisPlusInterceptor interceptor &#x3D; new MybatisPlusInterceptor();
		&#x2F;&#x2F;添加内部插件，DBType为设置数据库类型
		interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
		return interceptor;
	&#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="b-gt-测试类"><a href="#b-gt-测试类" class="headerlink" title="b&gt;测试类"></a>b&gt;测试类</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token comment">//设置分页参数，初始页码1，每页显示条数5</span>
	<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//进行查询，第二个参数是条件构造器，需要加条件用queryWrapper或lambdaQueryWrapper加</span>
	userMapper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//获取分页数据</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前页："</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"每页显示的条数："</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"总记录数："</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"总页数："</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"是否有上一页："</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">hasPrevious</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"是否有下一页："</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<h5 id="测试结果："><a href="#测试结果：" class="headerlink" title="测试结果："></a>测试结果：</h5><p>​    User(id=1, name=Jone, age=18, email= <a href="mailto:&#116;&#x65;&#x73;&#116;&#x31;&#64;&#x62;&#97;&#x6f;&#x6d;&#x69;&#x64;&#111;&#117;&#x2e;&#x63;&#x6f;&#x6d;">&#116;&#x65;&#x73;&#116;&#x31;&#64;&#x62;&#97;&#x6f;&#x6d;&#x69;&#x64;&#111;&#117;&#x2e;&#x63;&#x6f;&#x6d;</a>, isDeleted=0) </p>
<p>​    User(id=2, name=Jack, age=20, email= <a href="mailto:&#116;&#x65;&#x73;&#x74;&#50;&#64;&#98;&#97;&#111;&#109;&#105;&#x64;&#111;&#117;&#x2e;&#x63;&#x6f;&#109;">&#116;&#x65;&#x73;&#x74;&#50;&#64;&#98;&#97;&#111;&#109;&#105;&#x64;&#111;&#117;&#x2e;&#x63;&#x6f;&#109;</a>, isDeleted=0) </p>
<p>​    User(id=3, name=Tom, age=28, email= <a href="mailto:&#116;&#x65;&#115;&#116;&#x33;&#64;&#x62;&#97;&#x6f;&#109;&#x69;&#x64;&#111;&#x75;&#46;&#x63;&#x6f;&#109;">&#116;&#x65;&#115;&#116;&#x33;&#64;&#x62;&#97;&#x6f;&#109;&#x69;&#x64;&#111;&#x75;&#46;&#x63;&#x6f;&#109;</a>, isDeleted=0) </p>
<p>​    User(id=4, name=Sandy, age=21, email= <a href="mailto:&#x74;&#x65;&#x73;&#x74;&#x34;&#x40;&#x62;&#97;&#111;&#109;&#105;&#100;&#111;&#x75;&#46;&#x63;&#x6f;&#x6d;">&#x74;&#x65;&#x73;&#x74;&#x34;&#x40;&#x62;&#97;&#111;&#109;&#105;&#100;&#111;&#x75;&#46;&#x63;&#x6f;&#x6d;</a>, isDeleted=0) </p>
<p>​    User(id=5, name=Billie, age=24, email= test5@ba omidou.com, isDeleted=0) </p>
<p>​    当前页：1 每页显示的条数：5 总记录数：17 总页数：4 是否有上一 页：false 是否有下一页：true</p>
<h4 id="2-、xml自定义分页"><a href="#2-、xml自定义分页" class="headerlink" title="2 、xml自定义分页"></a>2 、xml自定义分页</h4><p>​    自定义分页，只需要在mapper层的方法，将page对象作为参数传，然后在xml中实现这个带page的方法，即可实现自定义分页</p>
<h5 id="a-gt-UserMapper中定义接口方法"><a href="#a-gt-UserMapper中定义接口方法" class="headerlink" title="a&gt;UserMapper中定义接口方法"></a>a&gt;UserMapper中定义接口方法</h5><pre class="line-numbers language-none"><code class="language-none">&#x2F;**
 * 根据年龄查询用户列表，分页显示
 * @param page 分页对象,xml中可以从里面进行取值,传递参数 Page 即自动分页,必须放在第一位
 * @param age 年龄
 * @return
*&#x2F;
	&#x2F;&#x2F;@Param是Mybatis的注解，在传输多参数是使用
	Page&lt;User&gt; selectPageVo(@Param(&quot;page&quot;) Page&lt;User&gt; page, @Param(&quot;age&quot;)
Integer age);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="b-gt-UserMapper-xml中编写SQL"><a href="#b-gt-UserMapper-xml中编写SQL" class="headerlink" title="b&gt;UserMapper.xml中编写SQL"></a>b&gt;UserMapper.xml中编写SQL</h5><pre class="line-numbers language-none"><code class="language-none">&lt;!--IPage&lt;User&gt; selectPageVo(Page&lt;User&gt; page, Integer age);--&gt;
&lt;select id&#x3D;&quot;selectPageVo&quot; resultType&#x3D;&quot;com.xxx.User&quot;&gt;
	SELECT id,username,age,email FROM t_user WHERE age # &#123;age&#125;
&lt;&#x2F;select&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>​    <strong>注意</strong>：<code>Mapper.xml</code>中的SQL只需实现查询<code>list</code>的逻辑即可，无需关注分页的逻辑</p>
<h5 id="c-gt-测试"><a href="#c-gt-测试" class="headerlink" title="c&gt;测试"></a>c&gt;测试</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void testSelectPageVo()&#123;
	&#x2F;&#x2F;设置分页参数
	Page&lt;User&gt; page &#x3D; new Page&lt;&gt;( 1 , 5 );
	userMapper.selectPageVo(page, 20 );
	&#x2F;&#x2F;获取分页数据
	List&lt;User&gt; list &#x3D; page.getRecords();
	list.forEach(System.out::println);
	System.out.println(&quot;当前页：&quot;+page.getCurrent());
	System.out.println(&quot;每页显示的条数：&quot;+page.getSize());
	System.out.println(&quot;总记录数：&quot;+page.getTotal());
	System.out.println(&quot;总页数：&quot;+page.getPages());
	System.out.println(&quot;是否有上一页：&quot;+page.hasPrevious());
	System.out.println(&quot;是否有下一页：&quot;+page.hasNext());
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="结果：-1"><a href="#结果：-1" class="headerlink" title="结果："></a>结果：</h5><p>User(id=3, name=Tom, age=28, email= <a href="mailto:&#x74;&#x65;&#115;&#x74;&#x33;&#64;&#x62;&#x61;&#111;&#109;&#x69;&#x64;&#x6f;&#117;&#46;&#x63;&#x6f;&#109;">&#x74;&#x65;&#115;&#x74;&#x33;&#64;&#x62;&#x61;&#111;&#109;&#x69;&#x64;&#x6f;&#117;&#46;&#x63;&#x6f;&#109;</a>, isDeleted=null) </p>
<p>User(id=4, name=Sandy, age=21, email= <a href="mailto:&#116;&#101;&#x73;&#x74;&#x34;&#x40;&#98;&#97;&#111;&#109;&#105;&#x64;&#x6f;&#117;&#46;&#x63;&#111;&#x6d;">&#116;&#101;&#x73;&#x74;&#x34;&#x40;&#98;&#97;&#111;&#109;&#105;&#x64;&#x6f;&#117;&#46;&#x63;&#111;&#x6d;</a>, isDeleted=null) </p>
<p>User(id=5, name=Billie, age=24, email= <a href="mailto:&#x74;&#x65;&#115;&#x74;&#x35;&#x40;&#98;&#97;&#x6f;&#x6d;&#105;&#100;&#x6f;&#x75;&#x2e;&#x63;&#111;&#x6d;">&#x74;&#x65;&#115;&#x74;&#x35;&#x40;&#98;&#97;&#x6f;&#x6d;&#105;&#100;&#x6f;&#x75;&#x2e;&#x63;&#111;&#x6d;</a>, isDeleted=null) </p>
<p>User(id=8, name=ybc1, age=21, email=null, isDeleted=null) </p>
<p>User(id=9, name=ybc2, age=22, email=null, isDeleted=null) </p>
<p>当前 页：1 每页显示的条数：5 总记录数：12 总页数：3 是否有上一页：false 是否有下一页：true</p>
<h4 id="3-、乐观锁"><a href="#3-、乐观锁" class="headerlink" title="3 、乐观锁"></a>3 、乐观锁</h4><h5 id="a-gt-场景"><a href="#a-gt-场景" class="headerlink" title="a&gt;场景"></a>a&gt;场景</h5><p>一件商品，成本价是80元，售价是100元。老板先是通知小李，说你去把商品价格增加50元。小 李正在玩游戏，耽搁了一个小时。正好一个小时后，老板觉得商品价格增加到150元，价格太 高，可能会影响销量。又通知小王，你把商品价格降低30元。 此时，小李和小王同时操作商品后台系统。小李操作的时候，系统先取出商品价格100元；小王 也在操作，取出的商品价格也是100元。小李将价格加了50元，并将100+50=150元存入了数据 库；小王将商品减了30元，并将100-30=70元存入了数据库。是的，如果没有锁，小李的操作就 完全被小王的覆盖了。 现在商品价格是70元，比成本价低10元。几分钟后，这个商品很快出售了1千多件商品，老板亏1万多。</p>
<h5 id="b-gt-乐观锁与悲观锁"><a href="#b-gt-乐观锁与悲观锁" class="headerlink" title="b&gt;乐观锁与悲观锁"></a>b&gt;乐观锁与悲观锁</h5><p>上面的故事，如果是乐观锁，小王保存价格前，会检查下价格是否被人修改过了。如果被修改过 了，则重新取出的被修改后的价格，150元，这样他会将120元存入数据库。 如果是悲观锁，小李取出数据后，小王只能等小李操作完之后，才能对价格进行操作，也会保证 最终的价格是120元。</p>
<h5 id="c-gt-模拟修改冲突"><a href="#c-gt-模拟修改冲突" class="headerlink" title="c&gt;模拟修改冲突"></a>c&gt;模拟修改冲突</h5><h6 id="数据库中增加商品表"><a href="#数据库中增加商品表" class="headerlink" title="数据库中增加商品表"></a>数据库中增加商品表</h6><pre class="line-numbers language-none"><code class="language-none">CREATE TABLE t_product
(
id BIGINT( 20 ) NOT NULL COMMENT &#39;主键ID&#39;,
NAME VARCHAR( 30 ) NULL DEFAULT NULL COMMENT &#39;商品名称&#39;,
price INT( 11 ) DEFAULT 0 COMMENT &#39;价格&#39;,
VERSION INT( 11 ) DEFAULT 0 COMMENT &#39;乐观锁版本号&#39;,
PRIMARY KEY (id)
);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h6><pre class="line-numbers language-none"><code class="language-none">INSERT INTO t_product (id, NAME, price) VALUES ( 1 , &#39;外星人笔记本&#39;, 100 );<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h6 id="添加实体"><a href="#添加实体" class="headerlink" title="添加实体"></a>添加实体</h6><pre class="line-numbers language-none"><code class="language-none">package com.atguigu.mybatisplus.entity;
import lombok.Data;

@Data
public class Product &#123;
	private Long id;
	private String name;
	private Integer price;
	private Integer version;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="添加mapper"><a href="#添加mapper" class="headerlink" title="添加mapper"></a>添加mapper</h6><pre class="line-numbers language-none"><code class="language-none">public interface ProductMapper extends BaseMapper&lt;Product&gt; &#123;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h6 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h6><pre class="line-numbers language-none"><code class="language-none">@Test
public void testConcurrentUpdate() &#123;
	&#x2F;&#x2F;1、小李
	Product p1 &#x3D; productMapper.selectById(1L);
	System.out.println(&quot;小李取出的价格：&quot; + p1.getPrice());
	
	&#x2F;&#x2F;2、小王
	Product p2 &#x3D; productMapper.selectById(1L);
	System.out.println(&quot;小王取出的价格：&quot; + p2.getPrice());
	
	&#x2F;&#x2F;3、小李将价格加了 50 元，存入了数据库
	p1.setPrice(p1.getPrice() + 50 );
	int result1 &#x3D; productMapper.updateById(p1);
	System.out.println(&quot;小李修改结果：&quot; + result1);
	
	&#x2F;&#x2F;4、小王将商品减了 30 元，存入了数据库
	p2.setPrice(p2.getPrice() - 30 );
	int result2 &#x3D; productMapper.updateById(p2);
	System.out.println(&quot;小王修改结果：&quot; + result2);
	
	&#x2F;&#x2F;最后的结果
	Product p3 &#x3D; productMapper.selectById(1L);
	&#x2F;&#x2F;价格覆盖，最后的结果： 70
	System.out.println(&quot;最后的结果：&quot; + p3.getPrice());
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="d-gt-乐观锁实现流程"><a href="#d-gt-乐观锁实现流程" class="headerlink" title="d&gt;乐观锁实现流程"></a>d&gt;乐观锁实现流程</h5><p>​    数据库中添加version字段</p>
<p>​    取出记录时，获取当前version</p>
<pre class="line-numbers language-none"><code class="language-none">SELECT id,&#96;name&#96;,price,&#96;version&#96; FROM product WHERE id&#x3D; 1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>​    更新时，version + 1，如果where语句中的version版本不对，则更新失败</p>
<pre class="line-numbers language-none"><code class="language-none">UPDATE product SET price&#x3D;price+ 50 , &#96;version&#96;&#x3D;&#96;version&#96; + 1 WHERE id&#x3D; 1 AND
&#96;version&#96;&#x3D; 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h5 id="e-gt-Mybatis-Plus实现乐观锁"><a href="#e-gt-Mybatis-Plus实现乐观锁" class="headerlink" title="e&gt;Mybatis-Plus实现乐观锁"></a>e&gt;Mybatis-Plus实现乐观锁</h5><h6 id="修改实体类"><a href="#修改实体类" class="headerlink" title="修改实体类"></a>修改实体类</h6><pre class="line-numbers language-none"><code class="language-none">package com.atguigu.mybatisplus.entity;
import com.baomidou.mybatisplus.annotation.Version;
import lombok.Data;

@Data
public class Product &#123;
	private Long id;
	private String name;
	private Integer price;
	@Version &#x2F;&#x2F;用于标识乐观锁版本号字段
	private Integer version;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="添加乐观锁插件配置"><a href="#添加乐观锁插件配置" class="headerlink" title="添加乐观锁插件配置"></a>添加乐观锁插件配置</h6><pre class="line-numbers language-none"><code class="language-none">@Bean
public MybatisPlusInterceptor mybatisPlusInterceptor()&#123;
	MybatisPlusInterceptor interceptor &#x3D; new MybatisPlusInterceptor();
	&#x2F;&#x2F;添加分页插件
	interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
	&#x2F;&#x2F;添加乐观锁插件
	interceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());
	return interceptor;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="测试修改冲突"><a href="#测试修改冲突" class="headerlink" title="测试修改冲突"></a>测试修改冲突</h6><p>小李查询商品信息： </p>
<p>SELECT id,name,price,version FROM t_product WHERE id=? </p>
<p>小王查询商品信息： </p>
<p>SELECT id,name,price,version FROM t_product WHERE id=? </p>
<p>小李修改商品价格，自动将version+1 </p>
<p>UPDATE t_product SET name=?, price=?, version=? WHERE id=? AND version=? Parameters: 外星人笔记本(String), 150(Integer), 1(Integer), 1(Long), 0(Integer) </p>
<p>小王修改商品价格，此时version已更新，条件不成立，修改失败 </p>
<p>UPDATE t_product SET name=?, price=?, version=? WHERE id=? AND version=? Parameters: 外星人笔记本(String), 70(Integer), 1(Integer), 1(Long), 0(Integer) </p>
<p>最终，小王修改失败，查询价格：150 </p>
<p>SELECT id,name,price,version FROM t_product WHERE id=?</p>
<h6 id="优化流程"><a href="#优化流程" class="headerlink" title="优化流程"></a>优化流程</h6><pre class="line-numbers language-none"><code class="language-none">@Test
public void testConcurrentVersionUpdate() &#123;
	&#x2F;&#x2F;小李取数据
	Product p1 &#x3D; productMapper.selectById(1L);
	
	&#x2F;&#x2F;小王取数据
	Product p2 &#x3D; productMapper.selectById(1L);
	
	&#x2F;&#x2F;小李修改 + 50
	p1.setPrice(p1.getPrice() + 50 );
	int result1 &#x3D; productMapper.updateById(p1);
	System.out.println(&quot;小李修改的结果：&quot; + result1);
	
	&#x2F;&#x2F;小王修改 - 30
	p2.setPrice(p2.getPrice() - 30 );
	int result2 &#x3D; productMapper.updateById(p2);
	System.out.println(&quot;小王修改的结果：&quot; + result2);
	if(result2 &#x3D;&#x3D; 0 )&#123;
		&#x2F;&#x2F;失败重试，重新获取version并更新
		p2 &#x3D; productMapper.selectById(1L);
		p2.setPrice(p2.getPrice() - 30 );
		result2 &#x3D; productMapper.updateById(p2);
	&#125;
	System.out.println(&quot;小王修改重试的结果：&quot; + result2);
	
	&#x2F;&#x2F;老板看价格
	Product p3 &#x3D; productMapper.selectById(1L);
	System.out.println(&quot;老板看价格：&quot; + p3.getPrice());	
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="八、通用枚举"><a href="#八、通用枚举" class="headerlink" title="八、通用枚举"></a>八、通用枚举</h3><p>​    表中的有些字段值是固定的，例如性别（男或女），此时我们可以使用MyBatis-Plus的通用枚举来实现</p>
<h5 id="a-gt-数据库表添加字段sex"><a href="#a-gt-数据库表添加字段sex" class="headerlink" title="a&gt;数据库表添加字段sex"></a>a&gt;数据库表添加字段sex</h5><p><a target="_blank" rel="noopener" href="https://imgse.com/i/pEo1Rk8"><img src="https://s21.ax1x.com/2025/04/24/pEo1Rk8.png" alt="pEo1Rk8.png"></a></p>
<h5 id="b-gt-创建通用枚举类型"><a href="#b-gt-创建通用枚举类型" class="headerlink" title="b&gt;创建通用枚举类型"></a>b&gt;创建通用枚举类型</h5><pre class="line-numbers language-none"><code class="language-none">package com.atguigu.mp.enums;
import com.baomidou.mybatisplus.annotation.EnumValue;
import lombok.Getter;
@Getter
public enum SexEnum &#123;
	MALE( 1 , &quot;男&quot;),
	FEMALE( 2 , &quot;女&quot;);
	
	@EnumValue &#x2F;&#x2F;该注解表示将此属性存入数据库中
	private Integer sex;
	private String sexName;
	SexEnum(Integer sex, String sexName) &#123;
		this.sex &#x3D; sex;
		this.sexName &#x3D; sexName;
	&#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="c-gt-配置扫描通用枚举"><a href="#c-gt-配置扫描通用枚举" class="headerlink" title="c&gt;配置扫描通用枚举"></a>c&gt;配置扫描通用枚举</h5><pre class="line-numbers language-none"><code class="language-none">mybatis-plus:
 configuration:
  # 配置MyBatis日志
  log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
 global-config:
  db-config:
   # 配置MyBatis-Plus操作表的默认前缀
   table-prefix: t_
   # 配置MyBatis-Plus的主键策略
   id-type: auto
 # 配置扫描通用枚举，扫描后才能枚举的注解启用
 type-enums-package: com.atguigu.mybatisplus.enums<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="d-gt-测试"><a href="#d-gt-测试" class="headerlink" title="d&gt;测试"></a>d&gt;测试</h5><pre class="line-numbers language-none"><code class="language-none">@Test
public void testSexEnum()&#123;
	User user &#x3D; new User();
	user.setName(&quot;Enum&quot;);
	user.setAge( 20 );
	&#x2F;&#x2F;设置性别信息为枚举项，会将@EnumValue注解所标识的属性值存储到数据库
	user.setSex(SexEnum.MALE);
	&#x2F;&#x2F;INSERT INTO t_user ( username, age, sex ) VALUES ( ?, ?,? )
	&#x2F;&#x2F;Parameters: Enum(String), 20(Integer), 1(Integer)
	userMapper.insert(user);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="九、代码生成器"><a href="#九、代码生成器" class="headerlink" title="九、代码生成器"></a>九、代码生成器</h3><p>​    通过表来生成控制层、业务层、持久层、mapper接口、映射文件</p>
<h4 id="1-、引入依赖"><a href="#1-、引入依赖" class="headerlink" title="1 、引入依赖"></a>1 、引入依赖</h4><pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
	&lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;
	&lt;artifactId&gt;mybatis-plus-generator&lt;&#x2F;artifactId&gt;
	&lt;version&gt;3.5.1&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.freemarker&lt;&#x2F;groupId&gt;
	&lt;artifactId&gt;freemarker&lt;&#x2F;artifactId&gt;
	&lt;version&gt;2.3.31&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="2-、快速生成"><a href="#2-、快速生成" class="headerlink" title="2 、快速生成"></a>2 、快速生成</h4><p>​    复制测试方法，执行就行</p>
<pre class="line-numbers language-none"><code class="language-none">public class FastAutoGeneratorTest &#123;
	public static void main(String[] args) &#123;
		FastAutoGenerator.create(&quot;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;mybatis_plus?characterEncoding&#x3D;utf-8&amp;userSSL&#x3D;false&quot;, &quot;root&quot;, &quot;123456&quot;)
			.globalConfig(builder -&gt; &#123;
				builder.author(&quot;atguigu&quot;) &#x2F;&#x2F; 设置作者
				&#x2F;&#x2F;.enableSwagger() &#x2F;&#x2F; 开启 swagger 模式
				.fileOverride() &#x2F;&#x2F; 覆盖已生成文件
				.outputDir(&quot;D:&#x2F;&#x2F;mybatis_plus&quot;); &#x2F;&#x2F; 指定输出目录
			&#125;)
			.packageConfig(builder -&gt; &#123;
				builder.parent(&quot;com.atguigu&quot;) &#x2F;&#x2F; 设置父包名
					.moduleName(&quot;mybatisplus&quot;) &#x2F;&#x2F; 设置父包模块名
					.pathInfo(Collections.singletonMap(OutputFile.mapperXml, &quot;D:&#x2F;&#x2F;mybatis_plus&quot;));&#x2F;&#x2F; 设置mapperXml生成路径
			&#125;)
			.strategyConfig(builder -&gt; &#123;
				builder.addInclude(&quot;t_user&quot;) &#x2F;&#x2F; 设置需要生成的表名
				.addTablePrefix(&quot;t_&quot;, &quot;c_&quot;); &#x2F;&#x2F; 设置过滤表前缀
			&#125;)
			.templateEngine(new FreemarkerTemplateEngine()) &#x2F;&#x2F; 使用Freemarker
引擎模板，默认的是Velocity引擎模板
			.execute();
	&#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="十、多数据源"><a href="#十、多数据源" class="headerlink" title="十、多数据源"></a>十、多数据源</h3><p>适用于多种场景：纯粹多库、 读写分离、 一主多从、 混合模式等</p>
<p>目前我们就来模拟一个纯粹多库的一个场景，其他场景类似</p>
<p>场景说明：</p>
<p>我们创建两个库，分别为：mybatis_plus（以前的库不动）与mybatis_plus_1（新建），将mybatis_plus库的product表移动到mybatis_plus_1库，这样每个库一张表，通过一个测试用例分别获取用户数据与商品数据，如果获取到说明多库模拟成功</p>
<p><strong>注意：</strong></p>
<p>​    <strong>1.要操作哪个数据库，在service层上用注解@DS(“application.yml配置的数据库名”)指定</strong></p>
<p>​    <strong>2.@DS可以注解在方法上或类上，同时存在就近原则，方法上注解优先类上注解（有此可以实现同service的主写从读功能）</strong></p>
<h4 id="1-、创建数据库及表"><a href="#1-、创建数据库及表" class="headerlink" title="1 、创建数据库及表"></a>1 、创建数据库及表</h4><p>​    创建数据库mybatis_plus_1和表product</p>
<pre class="line-numbers language-none"><code class="language-none">CREATE DATABASE &#96;mybatis_plus_1&#96; &#x2F;*!40100 DEFAULT CHARACTER SET utf8mb4 *&#x2F;;
use &#96;mybatis_plus_1&#96;;
CREATE TABLE product
(
	id BIGINT( 20 ) NOT NULL COMMENT &#39;主键ID&#39;,
	name VARCHAR( 30 ) NULL DEFAULT NULL COMMENT &#39;商品名称&#39;,
	price INT( 11 ) DEFAULT 0 COMMENT &#39;价格&#39;,
	version INT( 11 ) DEFAULT 0 COMMENT &#39;乐观锁版本号&#39;,
	PRIMARY KEY (id)
);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>​    添加测试数据</p>
<pre class="line-numbers language-none"><code class="language-none">INSERT INTO product (id, NAME, price) VALUES ( 1 , &#39;外星人笔记本&#39;, 100 );<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>​    删除mybatis_plus库product表</p>
<pre class="line-numbers language-none"><code class="language-none">use mybatis_plus;
DROP TABLE IF EXISTS product;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h4 id="2-、引入依赖"><a href="#2-、引入依赖" class="headerlink" title="2 、引入依赖"></a>2 、引入依赖</h4><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;需要引入的新依赖
&lt;dependency&gt;
	&lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;
	&lt;artifactId&gt;dynamic-datasource-spring-boot-starter&lt;&#x2F;artifactId&gt;
	&lt;version&gt;3.5.0&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="3-、配置多数据源"><a href="#3-、配置多数据源" class="headerlink" title="3 、配置多数据源"></a>3 、配置多数据源</h4><p>​    说明：注释掉之前的数据库连接，添加新配置</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
 # 配置数据源信息
 datasource:
  dynamic:
   # 设置默认的数据源或者数据源组,默认值即为master
   primary: master
   # 严格匹配数据源,默认false.true未匹配到指定数据源时抛异常,false使用默认数据源
   strict: false
   datasource:
    master:
     url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis_plus?characterEncoding&#x3D;utf-8&amp;useSSL&#x3D;false
     driver-class-name: com.mysql.cj.jdbc.Driver
     username: root
     password: 123456
    slave_1:
     url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis_plus_1?characterEncoding&#x3D;utf-8&amp;useSSL&#x3D;false
     driver-class-name: com.mysql.cj.jdbc.Driver
     username: root
     password: 123456<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="4-、创建用户service"><a href="#4-、创建用户service" class="headerlink" title="4 、创建用户service"></a>4 、创建用户service</h4><pre class="line-numbers language-none"><code class="language-none">public interface UserService extends IService&lt;User&gt; &#123;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">@DS(&quot;master&quot;) &#x2F;&#x2F;指定所操作的数据源
@Service
public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements
UserService &#123;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="5-、创建商品service"><a href="#5-、创建商品service" class="headerlink" title="5 、创建商品service"></a>5 、创建商品service</h4><pre class="line-numbers language-none"><code class="language-none">public interface ProductService extends IService&lt;Product&gt; &#123;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">@DS(&quot;slave_1&quot;)
@Service
public class ProductServiceImpl extends ServiceImpl&lt;ProductMapper, Product&gt;
implements ProductService &#123;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="6-、测试"><a href="#6-、测试" class="headerlink" title="6 、测试"></a>6 、测试</h4><pre class="line-numbers language-none"><code class="language-none">@Autowired
private UserService userService;
@Autowired
private ProductService productService;

@Test
public void testDynamicDataSource()&#123;
	System.out.println(userService.getById(1L));
	System.out.println(productService.getById(1L));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="结果：-2"><a href="#结果：-2" class="headerlink" title="结果："></a>结果：</h5><p>​    1 、都能顺利获取对象，则测试成功</p>
<p>​    2 、如果我们实现读写分离，将写操作方法加上主库数据源，读操作方法加上从库数据源，自动切换，是不是就能实现读写分离？是的</p>
<h3 id="十一、MyBatisX插件-idea使用"><a href="#十一、MyBatisX插件-idea使用" class="headerlink" title="十一、MyBatisX插件-idea使用"></a>十一、MyBatisX插件-idea使用</h3><p>​    MyBatis-Plus为我们提供了强大的mapper和service模板，能够大大的提高开发效率</p>
<p>​    但是在真正开发过程中，MyBatis-Plus并不能为我们解决所有问题，例如一些复杂的SQL，多表联查，我们就需要自己去编写代码和SQL语句，我们该如何快速的解决这个问题呢，这个时候可以使用MyBatisX插件</p>
<p>​    MyBatisX一款基于 IDEA 的快速开发插件，为效率而生。</p>
<p>​    MyBatisX插件用法：<a target="_blank" rel="noopener" href="https://baomidou.com/pages/ba5b24/">https://baomidou.com/pages/ba5b24/</a> </p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">拾雨</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://example.com/2025/05/03/%E8%AF%AD%E9%9B%8001-MybatisPlus/">http://example.com/2025/05/03/%E8%AF%AD%E9%9B%8001-MybatisPlus/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="/about" target="_blank">拾雨</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E8%AF%AD%E9%9B%80/">
                                    <span class="chip bg-color">语雀</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2025/05/11/Linux01-Linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/17.jpg" class="responsive-img" alt="Linux01-Linux基础命令">
                        
                        <span class="card-title">Linux01-Linux基础命令</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-05-11
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            拾雨
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2025/04/29/redis02-%E4%BA%8B%E5%8A%A1%E4%B8%8E%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%8C%81%E4%B9%85%E5%8C%96/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="redis02-事务与乐观锁和持久化">
                        
                        <span class="card-title">redis02-事务与乐观锁和持久化</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-04-29
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            拾雨
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/redis/">
                        <span class="chip bg-color">redis</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('2'),
            headingSelector: 'h1, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="tencent"
                   type="playlist"
                   id="9518097293"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='list'
                   preload='auto'
                   volume='0.7'
                   list-folded='false'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2025</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">拾雨</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
